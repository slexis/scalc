"undefined"!=typeof module&&(nerdamer=require("./nerdamer.core.js"),require("./Calculus.js")),function(){"use strict";var r=nerdamer.getCore(),e=r.PARSER,t=r.groups.N,n=r.groups.P,i=r.groups.S,a=r.groups.EX,o=r.groups.FN,s=r.groups.PL,l=r.groups.CP,u=r.groups.CB,f=r.Utils.keys,c=r.Utils.variables,h=r.Utils.round,p=r.Frac,v=r.Utils.isInt,d=r.Symbol,m=r.Settings.CONST_HASH,g=r.Utils.importFunctions();function b(t,n,i){if(r.Utils.isSymbol(t))this.parse(t);else if(isNaN(t))"string"==typeof t&&this.parse(e.parse(t));else{if(i=i||0,void 0===n)throw new Error("Polynomial expects a variable name when creating using order");this.coeffs=[],this.coeffs[i]=t,this.fill(t)}}function w(){this.factors={}}function y(e,t,n){this.terms=t||[],this.coeff=e,this.map=n,this.sum=new r.Frac(0),this.image=void 0}b.fromArray=function(r,e){if(void 0===e)throw new Error("A variable name must be specified when creating polynomial from array");var t=new b;return t.coeffs=r,t.variable=e,t},b.fit=function(r,e,t,n,i,a){var o=new Array(i+1),s=t-e;o[0]=e,o[i]=r,s-=r*Math.pow(n,i);for(var l=i-1;l>0;l--){var u=Math.pow(n,l),f=s/u,c=Math.sign(f)*Math.floor(Math.abs(f));s-=c*u,o[l]=c}if(0!==s)return null;for(l=0;l<o.length;l++)o[l]=new p(o[l]);return b.fromArray(o,a)},b.prototype={parse:function(n,i){if(this.variable=c(n)[0],!n.isPoly())throw new Error("Polynomial Expected! Received "+r.Utils.text(n));if(i=i||[],n.power.absEquals(1)||(n=e.expand(n)),n.group===r.groups.N)i[0]=n.multiplier;else if(n.group===r.groups.S)i[n.power.toDecimal()]=n.multiplier;else for(var a in n.symbols){var o=n.symbols[a],s=o.power;if(r.Utils.isSymbol(s))throw new Error("power cannot be a Symbol");s=o.group===t?0:s.toDecimal(),o.symbols?this.parse(o,i):i[s]=o.multiplier}this.coeffs=i,this.fill()},fill:function(r){r=Number(r)||0;for(var e=this.coeffs.length,t=0;t<e;t++)void 0===this.coeffs[t]&&(this.coeffs[t]=new p(r));return this},trim:function(){for(var r=this.coeffs.length;r--;){var e=this.coeffs[r],t=e.equals(0);if(!e||!t)break;if(0===r)break;this.coeffs.pop()}return this},modP:function(r){for(var e=this.coeffs.length,t=0;t<e;t++){var n=this.coeffs[t];if(n<0){for(var i,a=t;a<e;a++)if(this.coeffs[a]>0){i=this.coeffs[a];break}if(i){for(;a>t;a--)this.coeffs[a]=this.coeffs[a].subtract(new p(1)),this.coeffs[a-1]=this.coeffs[a-1].add(new p(r));n=this.coeffs[t]}}var o=n.mod(r),s=n.subtract(o).divide(r);if(!s.equals(0)){var l=t+1,u=this.coeffs[l]||new p(0);u=u.add(s),this.coeffs[l]=new p(u),this.coeffs[t]=new p(o)}}return this},add:function(r){for(var e=Math.max(this.coeffs.length,r.coeffs.length),t=0;t<e;t++){var n=this.coeffs[t]||new p(0),i=r.coeffs[t]||new p(0);this.coeffs[t]=n.add(i)}return this},subtract:function(r){for(var e=Math.max(this.coeffs.length,r.coeffs.length),t=0;t<e;t++){var n=this.coeffs[t]||new p(0),i=r.coeffs[t]||new p(0);this.coeffs[t]=n.subtract(i)}return this},divide:function(e){for(var t=this.variable,n=r.Utils.arrayClone(this.coeffs),i=r.Utils.arrayClone(e.coeffs),a=n.length,o=i.length-1,s=[],l=0;l<a;l++){var u=a-(l+1),f=u-o,c=n[u].divide(i[o]);if(f<0)break;s[f]=c;for(var h=0;h<=o;h++)n[h+f]=n[h+f].subtract(i[h].multiply(c))}var p=b.fromArray(n,t||"x").trim();return[b.fromArray(s,t||"x"),p]},multiply:function(r){for(var e=this.coeffs.length,t=r.coeffs.length,n=[],i=0;i<e;i++)for(var a=this.coeffs[i],o=0;o<t;o++){var s=i+o,l=r.coeffs[o],u=n[s]||new p(0);n[s]=u.add(a.multiply(l))}return this.coeffs=n,this},isZero:function(){for(var r=this.coeffs.length,e=0;e<r;e++){if(!this.coeffs[e].equals(0))return!1}return!0},sub:function(r){for(var e=new p(0),t=this.coeffs.length,n=0;n<t;n++){var i=this.coeffs[n];i.equals(0)||(e=e.add(i.multiply(new p(Math.pow(r,n)))))}return e},clone:function(){var r=new b;return r.coeffs=this.coeffs,r.variable=this.variable,r},deg:function(){return this.trim(),this.coeffs.length-1},lc:function(){return this.coeffs[this.deg()].clone()},monic:function(){for(var r=this.lc(),e=this.coeffs.length,t=0;t<e;t++)this.coeffs[t]=this.coeffs[t].divide(r);return this},gcd:function(e){if(this.coeffs.length-1<e.coeffs.length-1)return e.gcd(this);for(var t=this;!e.isZero();){var n=e.clone();e=(t=t.clone()).divide(n)[1],t=n}var i=r.Math2.QGCD.apply(null,t.coeffs);if(!i.equals(1))for(var a=t.coeffs.length,o=0;o<a;o++)t.coeffs[o]=t.coeffs[o].divide(i);return t},diff:function(){for(var r=[],e=this.coeffs.length,t=1;t<e;t++)r.push(this.coeffs[t].multiply(new p(t)));return this.coeffs=r,this},integrate:function(){for(var r=[0],e=this.coeffs.length,t=0;t<e;t++){var n=new p(t+1);r[n]=this.coeffs[t].divide(n)}return this.coeffs=r,this},gcf:function(e){for(var t=[],n=0;n<this.coeffs.length;n++){var i=this.coeffs[n];i.equals(0)||-1!==t.indexOf(i)||t.push(i)}var a=[r.Math2.QGCD.apply(void 0,t),function(r){for(var e=0;e<r.length;e++)if(!r[e].equals(0))return e}(this.coeffs)].toDecimal();if(e){var o=[];o[a[1]-1]=a[0],a=b.fromArray(o,this.variable).fill()}return a},quad:function(r){var e=[];if(this.coeffs.length>3)throw new Error("Cannot calculate quadratic order of "+(this.coeffs.length-1));if(0===this.coeffs.length)throw new Error("Polynomial array has no terms");var t=this.coeffs[2]||0,n=this.coeffs[1]||0,i=n*n-4*t*this.coeffs[0];return i<0&&!r?e:(e[0]=(-n+Math.sqrt(i))/(2*t),e[1]=(-n-Math.sqrt(i))/(2*t),e)},squareFree:function(){for(var r=this.clone(),e=1,t=r.clone().diff(),n=r.clone().gcd(t),i=r.divide(n)[0],a=b.fromArray([new p(1)],r.variable);!n.equalsNumber(1);){var o=i.gcd(n),s=i.divide(o)[0];if(!s.equalsNumber(1)&&e>1){for(var l=s.clone(),u=1;u<e;u++)l.multiply(s.clone());s=l}a=a.multiply(s),e++,i=o,n=n.divide(o)[0]}return[a,i,e]},toSymbol:function(){var t=this.coeffs.length,n=this.variable;if(0===t)return new r.Symbol(0);for(var i=t-1,a="",o=0;o<t;o++){var s=o===i?"":"+",l=this.coeffs[o];l.equals(0)||(a+=l+"*"+n+"^"+o+s)}return e.parse(a)},equalsNumber:function(r){return this.trim(),1===this.coeffs.length&&this.coeffs[0].toDecimal()===String(r)},toString:function(){return this.toSymbol().toString()}},d.prototype.coeffs=function(r,t){t&&!this.isPoly(!0)&&e.error("Polynomial expected when requesting coefficients with order"),r=r||[];var n=this.clone().distributeMultiplier();if(n.isComposite())for(var i in n.symbols){var a=n.symbols[i];a.isComposite()?a.clone().distributeMultiplier().coeffs(r,t):t?r[a.isConstant()?0:a.power.toDecimal()]=a.multiplier:r.push(a.multiplier)}else t?r[n.isConstant()?0:n.power.toDecimal()]=n.multiplier:r.push(n.multiplier);if(t)for(var o=0;o<r.length;o++)void 0===r[o]&&(r[o]=new p(0));return r},d.prototype.tBase=function(r){if(void 0===r)throw new Error("Symbol.tBase requires a map object!");for(var e=[],t=this.collectSymbols(null,null,null,!0),n=t.length,i=0;i<n;i++){var a=t[i],o=a.group,s=new y(a.multiplier,[],r);if(o===u)for(var l in a.symbols){var f=a.symbols[l];s.terms[r[l]]=f.power}else s.terms[r[a.value]]=a.power;e.push(s.fill()),s.updateCount()}return e},d.prototype.altVar=function(r){var e=this.multiplier.toString(),t=this.power.toString();return("1"===e?"":e+"*")+r+("1"===t?"":"^"+t)},d.prototype.sameVars=function(r){if(!this.symbols&&this.group!==r.group)return!1;for(var e in this.symbols){var t=this.symbols[e],n=r.symbols[e];if(!n)return!1;if(t.value!==n.value)return!1}return!0},d.prototype.groupTerms=function(t){var n,i,a;t=String(t);var o=[];return this.each(function(l){if(l.group===s){a=l.groupTerms(t);for(var u=0;u<a.length;u++){var f=a[u];f&&(o[u]=f)}}else n=r.Utils.decompose_fn(l,t,!0),i=n.x.value===t?Number(n.x.power):0,o[i]=e.add(o[i]||new d(0),n.a)}),o},d.prototype.collectFactors=function(){var r=[];return this.group===u?this.each(function(e){r.push(e.clone())}):r.push(this.clone()),r},w.prototype.add=function(r){if(r.equals(0))return this;if(r.group===u){var t=this;r.multiplier.equals(1)||t.add(new d(r.multiplier)),r.each(function(r){t.add(r)})}else{this.preAdd&&(r=this.preAdd(r)),this.pFactor&&(r=e.pow(r,new d(this.pFactor)));var n=r.isConstant();if(n&&r.equals(1))return this;var i=n?r.value:r.text();i in this.factors?this.factors[i]=e.multiply(this.factors[i],r):this.factors[i]=r}return this},w.prototype.toSymbol=function(){var t=new d(1);for(var n in this.factors){var i=this.factors[n],a=(i.group,i.power.equals(1)?e.symfunction(r.PARENTHESIS,[this.factors[n]]):this.factors[n]);t=e.multiply(t,a)}return""===t.fname&&(t=d.unwrapPARENS(t)),t},w.prototype.merge=function(r){for(var t in r)t in this.factors?this.factors[t]=e.multiply(this.factors[t],r[t]):this.factors[t]=r[t];return this},w.prototype.each=function(e){for(var t in this.factors){var n=this.factors[t];n.fname===r.PARENTHESIS&&n.isLinear()&&(n=n.args[0]),e.call(this,n,t)}return this},w.prototype.count=function(){return f(this.factors).length},w.prototype.clean=function(){try{var e=r.Settings.CONST_HASH;this.factors[e].lessThan(0)&&(this.factors[e].equals(-1)?delete this.factors[e]:this.factors[e].negate(),this.each(function(r){r.negate()}))}catch(r){}},w.prototype.toString=function(){return this.toSymbol().toString()},y.prototype.updateCount=function(){this.count=this.count||0;for(var r=0;r<this.terms.length;r++)this.terms[r].equals(0)||this.count++;return this},y.prototype.getVars=function(){for(var r=[],e=0;e<this.terms.length;e++){var t=this.terms[e];this.getRevMap();t.equals(0)||r.push(this.rev_map[e])}return r.join(" ")},y.prototype.len=function(){return void 0===this.count&&this.updateCount(),this.count},y.prototype.toSymbol=function(r){r=r||this.getRevMap();for(var t=new d(this.coeff),n=0;n<this.terms.length;n++){var i=r[n],a=this.terms[n];if(!a.equals(0)&&i!==m){var o=new d(i);o.power=a,t=e.multiply(t,o)}}return t},y.prototype.getRevMap=function(){if(this.rev_map)return this.rev_map;var r={};for(var e in this.map)r[this.map[e]]=e;return this.rev_map=r,r},y.prototype.generateImage=function(){return this.image=this.terms.join(" "),this},y.prototype.getImg=function(){return this.image||this.generateImage(),this.image},y.prototype.fill=function(){for(var e=this.map.length,t=0;t<e;t++)void 0===this.terms[t]?this.terms[t]=new r.Frac(0):this.sum=this.sum.add(this.terms[t]);return this},y.prototype.divide=function(r){for(var e=this.coeff.divide(r.coeff),t=this.terms.length,n=new y(e,[],this.map),i=0;i<t;i++)n.terms[i]=this.terms[i].subtract(r.terms[i]),n.sum=n.sum.add(n.terms[i]);return n},y.prototype.multiply=function(r){for(var e=this.coeff.multiply(r.coeff),t=this.terms.length,n=new y(e,[],this.map),i=0;i<t;i++)n.terms[i]=this.terms[i].add(r.terms[i]),n.sum=n.sum.add(n.terms[i]);return n},y.prototype.isZero=function(){return this.coeff.equals(0)},y.prototype.toString=function(){return"{ coeff: "+this.coeff.toString()+", terms: ["+this.terms.join(",")+"]: sum: "+this.sum.toString()+", count: "+this.count+"}"},r.Utils.toMapObj=function(r){for(var e=0,t={},n=0;n<r.length;n++){var i=r[n];void 0===t[i]&&(t[i]=e,e++)}return t.length=e,t},r.Utils.filledArray=function(r,e,t){for(var n=[];e--;)n[e]=t?new t(r):r;return n},r.Utils.arrSum=function(r){for(var e=0,t=r.length,n=0;n<t;n++)e+=r[n];return e},r.Utils.haveIntersection=function(r,e){var t;return e.length>r.length&&(t=e,e=r,r=t),r.some(function(r){return e.indexOf(r)>-1})},r.Utils.subFunctions=function(e,t){t=t||{};var n=[];return e.each(function(e){if(e.group===o||e.previousGroup===o){var i=r.Utils.text(e,"hash"),a=t[i];if(a)n.push(e.altVar(a));else{var c=e.fname+f(t).length;t[i]=c,n.push(e.altVar(c))}}else e.group===u||e.group===s||e.group===l?n.push(r.Utils.subFunctions(e,t)):n.push(e.text())}),e.group===l||e.group===s?e.altVar(r.Utils.inBrackets(n.join("+"))):e.group===u?e.altVar(r.Utils.inBrackets(n.join("*"))):e.text()},r.Utils.getFunctionsSubs=function(r){var t={};for(var n in r)t[r[n]]=e.parse(n);return t};var M=r.Algebra={version:"1.4.5",init:void 0,proots:function(t,n){n=n||7;var a=[],o=function(r,e,t){for(var i=function(r,e,t){var i=r.slice(0);if(r.unshift(t),t>100)throw new Error("This utility accepts polynomials of degree up to 100. ");var a=[],o={};for(o.Degree=t,M=0;M<t;M++)a.push(0);var s=a.slice(0);function l(r,e,t,n,i,a){i[0]=a.b=n[0],i[1]=a.a=-e*a.b+n[1];for(var o=2;o<r;o++)i[o]=-(e*a.a+t*a.b)+n[o],a.b=a.a,a.a=i[o]}function u(r,e,t,n,i,a,o,s,u){var f=new Object,c=3;return f.b=f.a=0,l(e,o,s,a,u,f),i.c=f.a,i.d=f.b,Math.abs(i.c)<=100*r*Math.abs(a[e-1])&&Math.abs(i.d)<=100*r*Math.abs(a[e-2])?c:(i.h=s*n,Math.abs(i.d)>=Math.abs(i.c)?(c=2,i.e=t/i.d,i.f=i.c/i.d,i.g=o*n,i.a3=i.e*(i.g+t)+i.h*(n/i.d),i.a1=-t+i.f*n,i.a7=i.h+(i.f+o)*t):(c=1,i.e=t/i.c,i.f=i.d/i.c,i.g=i.e*o,i.a3=i.e*t+(i.g+i.h/i.c)*n,i.a1=-t*(i.d/i.c)+n,i.a7=i.g*i.d+i.h*i.f+t),c)}function f(r,e,t,n,i,a,o,s,l){var u;if(3!=t)if(u=1==t?i:n,Math.abs(a.a1)>10*r*Math.abs(u)){a.a7/=a.a1,a.a3/=a.a1,o[0]=l[0],o[1]=-l[0]*a.a7+l[1];for(var f=2;f<e;f++)o[f]=-l[f-1]*a.a7+s[f-2]*a.a3+l[f]}else{o[0]=0,o[1]=-l[0]*a.a7;for(var f=2;f<e;f++)o[f]=-l[f-1]*a.a7+s[f-2]*a.a3}else{o[1]=o[0]=0;for(var f=2;f<e;f++)o[f]=s[f-2]}}function c(r,e,t,n,i,a,o,s,l,u,f,c,h,p,v,d,m){var g,b,w,y,M,q,S,U;e.b=e.a=0,3!=r&&(2!=r?(g=t+h*o+c*u,b=s+(h+p*u)*l):(g=(t+f)*u+c,b=(u+h)*s+p*l),w=-v[d-1]/m[d],y=-(v[d-2]+w*m[d-1])/m[d],0!=(U=-(S=-((M=w*a)+(q=w*w*i))+p*y*n)+b+w*g)&&(e.a=-(h*(q+M)+p*(w*n+y*a))/U+h,e.b=p*(1+S/U)))}function p(r,e,t,n){var i,a,o;n.sr=n.si=n.lr=n.li=0,0!=r?0!=t?(i=e/2,Math.abs(i)<Math.abs(t)?(o=-(o=t>=0?r:-r)+i*(i/Math.abs(t)),a=Math.sqrt(Math.abs(o))*Math.sqrt(Math.abs(t))):(o=-r/i*(t/i)+1,a=Math.sqrt(Math.abs(o))*Math.abs(i)),o>=0?(a=i>=0?-a:a,n.lr=(-i+a)/r,n.sr=0!=n.lr?t/n.lr/r:n.sr):(n.lr=n.sr=-i/r,n.si=Math.abs(a/r),n.li=-n.si)):n.lr=-e/r:n.sr=0!=e?-t/e:n.sr}function v(r,e,t,n,i,a,o,s,h,v,d,m){var g,b,w,y,M,q,S,U,F,x,N,A,C=new Object,E=0,k=0;t.NZ=0,q=n,U=i;do{if(C.li=C.lr=C.si=C.sr=0,p(1,q,U,C),t.szr=C.sr,t.szi=C.si,t.lzr=C.lr,t.lzi=C.li,Math.abs(Math.abs(t.szr)-Math.abs(t.lzr))>.01*Math.abs(t.lzr))break;for(l(o,q,U,h,a,s),b=Math.abs(-t.szr*s.b+s.a)+Math.abs(t.szi*s.b),x=Math.sqrt(Math.abs(U)),g=2*Math.abs(a[0]),M=-t.szr*s.b,N=1;N<e;N++)g=g*x+Math.abs(a[N]);if(g=(9*(g=g*x+Math.abs(M+s.a))+2*Math.abs(M)-7*(Math.abs(s.a+M)+x*Math.abs(s.b)))*r,b<=20*g){t.NZ=2;break}if(++E>20)break;if(E>=2&&y<=.01&&b>=w&&!k){for(y=y<r?Math.sqrt(r):Math.sqrt(y),l(o,q-=q*y,U+=U*y,h,a,s),N=0;N<5;N++)A=u(r,e,s.a,s.b,d,m,q,U,v),f(r,e,A,s.a,s.b,d,m,v,a);k=1,E=0}w=b,A=u(r,e,s.a,s.b,d,m,q,U,v),f(r,e,A,s.a,s.b,d,m,v,a),c(A=u(r,e,s.a,s.b,d,m,q,U,v),s,s.a,d.a1,d.a3,d.a7,s.b,d.c,d.d,d.f,d.g,d.h,q,U,m,e,h),S=s.a,0!=(F=s.b)&&(y=Math.abs((-U+F)/F),q=S,U=F)}while(0!=F)}function d(r,e,t,n,i,a,o,s,l){var u,f,c,h,p,v,d,m,g,b,w,y=n-1;for(e.NZ=w=g=0,d=t.a;;){for(v=i[0],o[0]=v,b=1;b<a;b++)o[b]=v=v*d+i[b];for(c=Math.abs(v),h=Math.abs(d),u=.5*Math.abs(o[0]),b=1;b<a;b++)u=u*h+Math.abs(o[b]);if(c<=20*r*(2*u-c)){e.NZ=1,e.szr=d,e.szi=0;break}if(++w>10)break;if(w>=2&&Math.abs(m)<=.001*Math.abs(-m+d)&&c>p){g=1,e.a=d;break}for(p=c,l[0]=f=s[0],b=1;b<n;b++)l[b]=f=f*d+s[b];if(Math.abs(f)>10*Math.abs(s[y])*r)for(m=-v/f,s[0]=o[0],b=1;b<n;b++)s[b]=m*l[b-1]+o[b];else for(s[0]=0,b=1;b<n;b++)s[b]=l[b-1];for(f=s[0],b=1;b<n;b++)f=f*d+s[b];m=Math.abs(f)>10*Math.abs(s[y])*r?-v/f:0,d+=m}return g}function m(r,e,t,n,i,a,o,s,h,p,m,g){var b,w,y,M,q,S,U,F,x,N,A,C,E,k,D,P,T,L,R,z,V,_,I,j,O,Z=new Object,B=new Object,G=new Array(e),H=new Array(e),Q=1;for(g.NZ=0,M=y=.25,q=n,F=i,Z.b=Z.a=0,l(h,m,i,s,p,Z),b=Z.a,w=Z.b,B.h=B.g=B.f=B.e=B.d=B.c=B.a7=B.a3=B.a1=0,I=u(r,o,b,w,B,a,m,i,G),z=0;z<t;z++){if(L=1,f(r,o,I,b,w,B,a,G,p),c(I=u(r,o,b,w,B,a,m,i,G),Z,b,B.a1,B.a3,B.a7,w,B.c,B.d,B.f,B.g,B.h,m,i,a,o,s),D=Z.a,T=P=Z.b,N=0!=a[o-1]?-s[o]/a[o-1]:0,A=E=1,0!=z&&3!=I&&(E=0!=T?Math.abs((T-F)/T):E,A=0!=N?Math.abs((N-q)/N):A,k=E<U?E*U:1,C=A<S?A*S:1,j=k<M?1:0,(V=C<y?1:0)||j)){for(R=0;R<o;R++)H[R]=a[R];for(x=N,_=O=0;;){if(L&&0==(L=0)&&V&&(!j||C<k));else{if(v(r,o,g,D,P,p,h,Z,s,G,B,a),b=Z.a,w=Z.b,g.NZ>0)return;if(Q=O=1,M*=.25,_||!V)Q=0;else for(R=0;R<o;R++)a[R]=H[R]}if(0!=Q){if(Z.a=x,Q=d(r,g,Z,o,s,h,p,a,G),x=Z.a,g.NZ>0)return;if(_=1,y*=.25,0!=Q){D=-(x+x),P=x*x;continue}}for(R=0;R<o;R++)a[R]=H[R];if(!j||O)break}l(h,m,i,s,p,Z),b=Z.a,w=Z.b,I=u(r,o,b,w,B,a,m,i,G)}F=T,q=N,U=E,S=A}}!function(r,e,t,n){var i,a,o,s,l,u,f,c,h,v,d,g,b,w,y,M,q,S,U,F,x,N,A,C=r.Degree,E=.017453292519943295,k=Math.LN2,D=r.Degree+1,P=new Array(D),T=new Array(D),L=new Array(D),R=new Array(D),z=new Object,V=new Object;g=1;do{a=g,b=1+(g/=2)}while(b>1);var _=Number.MIN_VALUE/a,I=Math.cos(94*E),j=Math.sin(94*E),O=Math.sqrt(.5),Z=-O;V.NZ=S=0,V.szr=V.szi=V.lzr=V.lzi=0;for(;0==e[C];)t[S]=n[S]=0,C--,S++;N=C+1;for(;C>=1;){if(C<=2){C<2?(t[r.Degree-1]=-e[1]/e[0],n[r.Degree-1]=0):(z.li=z.lr=z.si=z.sr=0,p(e[0],e[1],e[2],z),t[r.Degree-2]=z.sr,n[r.Degree-2]=z.si,t[r.Degree-1]=z.lr,n[r.Degree-1]=z.li);break}for(f=0,c=Number.MAX_VALUE,B=0;B<N;B++)(v=Math.abs(e[B]))>f&&(f=v),0!=v&&v<c&&(c=v);if(((h=_/c)<=1&&f>=10||h>1&&Number.MAX_VALUE/h>=f)&&(h=0==h?Number.MIN_VALUE:h,F=Math.floor(Math.log(h)/k+.5),1!=(l=Math.pow(2,F))))for(B=0;B<N;B++)e[B]*=l;for(var B=0;B<N;B++)T[B]=Math.abs(e[B]);T[C]=-T[C],x=C-1,v=Math.exp((Math.log(-T[C])-Math.log(T[0]))/C),0!=T[x]&&(d=-T[C]/T[x],v=d<v?d:v),d=v;do{d=.1*(v=d),u=T[0];for(var B=1;B<N;B++)u=u*d+T[B]}while(u>0);s=v;do{o=u=T[0];for(var B=1;B<C;B++)u=v*u+T[B],o=v*o+u;u=v*u+T[C],v-=s=u/o}while(Math.abs(s/v)>.005);i=v;for(var B=1;B<C;B++)P[B]=(C-B)*e[B]/C;for(P[0]=e[0],g=e[C],b=e[x],A=0==P[x]?1:0,U=0;U<5;U++)if(w=P[x],A){for(var B=0;B<x;B++)P[S=x-B]=P[S-1];P[0]=0,A=0==P[x]?1:0}else{M=-g/w;for(var B=0;B<x;B++)P[S=x-B]=M*P[S-1]+e[S];P[0]=e[0],A=Math.abs(P[x])<=Math.abs(b)*a*10?1:0}for(var B=0;B<C;B++)R[B]=P[B];for(U=1;U<=20;U++){if(q=-j*Z+I*O,Z=j*O+I*Z,m(a,D,20*U,y=i*(O=q),i,P,C,e,N,L,-2*y,V),0!=V.NZ){S=r.Degree-C,t[S]=V.szr,n[S]=V.szi,N-=V.NZ,C=N-1;for(var B=0;B<N;B++)e[B]=L[B];1!=V.NZ&&(t[S+1]=V.lzr,n[S+1]=V.lzi);break}for(var B=0;B<C;B++)P[B]=R[B]}if(U>20){r.Degree-=C;break}}}(o,i,s,a);var g=a.length;for(M=0;M<g;M++){var b=h(a[M],n+8),w=h(s[M],n);w=n-String(w).length>2?w:s[M];var y=b<0?"-":"";0===w&&(w=""),0===b&&(b=""),b=1===Math.abs(b)?y+"i":b?b+"*i":"";var q=w&&b?w+"+"+b:w+b;s[M]=q.replace(/\+\-/g,"-")}return s}(r,0,t).concat(a),o=0;o<0;o++)i.unshift(0);return i};if(t instanceof d&&t.isPoly()){if(t.distributeMultiplier(),t.group===s){var l=r.Utils.arrayMin(f(t.symbols)),u=t.symbols[l].clone().toUnitMultiplier();t=e.expand(e.divide(t,u)),a.push(0)}if(t.group===r.groups.S)return[0];if(t.group===r.groups.PL){var c=f(t.symbols),p=r.Utils.arrayMin(c);t=r.PARSER.divide(t,r.PARSER.parse(t.value+"^"+p))}for(var v=f(t.symbols).sort().pop(),g=t.group===r.groups.PL?t.symbols:t.symbols[v],b=g.group,w=(c=b===i?[g.power.toDecimal()]:f(g.symbols),[]),y=r.Utils.arrayMax(c),M=1;M<=y;M++){var q=0;-1!==c.indexOf(M+"")&&(q=b===i?g.multiplier:g.symbols[M].multiplier),w.unshift(q)}return w.push(t.symbols[m].multiplier),g.group===i&&(w[0]=g.multiplier),o(w,0,y)}if(r.Utils.isArray(t)){var S=t,U=(w=[],c=[],0);for(M=0;M<S.length;M++){for(var F=S[M][0],x=S[M][1],N=x-U-1,A=0;A<N;A++)w.unshift(0);w.unshift(F),0!==x&&c.push(x),U=x}return o(w,0,y=Math.max.apply(void 0,c))}throw new Error("Cannot calculate roots. Symbol must be a polynomial!")},roots:function(t){var n=M.proots(t).map(function(r){return e.parse(r)});return r.Vector.fromArray(n)},froot:function(e,t,n){return function(t){for(var i=n||r.Utils.build(r.Calculus.diff(e.clone())),a=e instanceof Function?e:r.Utils.build(e),o=!1,s=0;!o;){var l=t-a(t)/i(t),u=Math.abs(l)-Math.abs(t);t=l,Math.abs(u)<1e-12?o=!0:s>1e4&&(t=null,o=!0),s++}return t}(Number(t))},quad:function(r,t,n){var i=function(r,t,n,i){return e.parse("-("+t+"+"+i+"*sqrt(("+t+")^2-4*("+r+")*("+n+")))/(2*"+r+")")};return[i(r,t,n,1),i(r,t,n,-1)]},sumProd:function(r,e){return M.quad(-e,r,-1).map(function(r){return r.invert()})},coeffs:function(r,t,n){t=String(t),r=e.expand(r),n=n||[],r.group===a&&r.contains(t,!0)&&e.error("Unable to get coefficients using expression "+r.toString());var i=c(r);if(i.length<=1&&i[0]===t)for(var o=new b(r).coeffs.map(function(r){return new d(r)}),s=0,f=o.length;s<f;s++){var h=o[s];(m=n[s])&&(h=e.add(m,h)),n[s]=h}else if(t||e.error("Polynomial contains more than one variable. Please specify which variable is to be used!"),-1===i.indexOf(t))n[0]=r;else if(n=n||[],r.group===u){var p=r.symbols[t];p||e.error("Expression is not a polynomial!");var m,g=Number(p.power);((h=e.divide(r.clone(),p.clone())).contains(t,!0)||g<0||!v(g))&&e.error("Expression is not a polynomial!"),(m=n[g])&&(h=e.add(m,h)),n[g]=h}else r.group===l&&r.each(function(r){M.coeffs(r.clone(),t,n)},!0);for(s=0,f=n.length;s<f;s++)void 0===n[s]&&(n[s]=new d(0));return n},polyPowers:function(e,n,a){if(a=a||[],(h=h=e.group)===s&&n===e.value)a=a.concat(f(e.symbols));else if(h===l)for(var o in e.symbols){var c=e.symbols[o],h=c.group,p=c.value;if(h===i&&n===p)a.push(c.power);else if(h===s||h===l)a=M.polyPowers(c,n,a);else if(h===u&&c.contains(n)){var v=c.symbols[n];v&&a.push(v.power)}else h!==t&&n===p||a.push(0)}else h===u&&e.contains(n)&&a.push(r.Utils.decompose_fn(e,n,!0).x.power);return r.Utils.arrayUnique(a).sort()},Factor:{mix:function(r,e){for(var t=f(r),n=t.length,i=[],a=0;a<n;a++){for(var o=t[a],s=r[o],l=i.length,u=0;u<l;u++){var c=i[u]*o;i.push(c),e&&i.push(-c)}for(u=1;u<=s;u++)i.push(Math.pow(o,u))}return i},common:function(t,n){try{if(t.group===l){for(var i=e.expand(t.clone(),!0).collectSymbols(null,null,function(r,e){return(e.length||1)-(r.length||1)}),a={},o=[],s=0;s<i.length;s++){var u=i[s];o.push(u.multiplier.clone()),u.each(function(r){var e=Number(r.power);if(isNaN(e))throw new Error("exiting");r.value in a?(e<a[r.value][0]&&(a[r.value][0]=e),a[r.value][1].push(r)):a[r.value]=[e,[r]]})}var f=new d(1);for(var c in a)a[c][1].length===i.length&&(f=e.multiply(f,e.pow(new d(c),new d(a[c][0]))));var h=r.Math2.QGCD.apply(null,o);if(!h.equals(1)){n.add(new d(h));for(s=0;s<i.length;s++)i[s].multiplier=i[s].multiplier.divide(h)}if(!f.equals(1)){n.add(f),t=new d(0);for(s=0;s<i.length;s++)t=e.add(t,e.divide(i[s],f.clone()))}}}catch(r){}return t},zeroes:function(t,n){var i=function(){throw new Error("Exiting")};try{var a,o,s,u,f;f=(t=e.expand(t.clone())).toString(),a=c(t),s=new d(0);for(var h=[],m=[],g=0,b=a.length;g<a.length;g++){for(var w={},y=0;y<b;y++)g!==y&&(w[a[y]]=0);var q=(o=e.parse(f,w)).power;v(q)||i(),h.push(o),m.push(o.power)}if(r.Utils.allSame(m)){var S=t.length,U=h.length;2===U&&(u=new p(m[0]/(S-1))),3===U&&(u=new p(m[0]/Math.round((Math.sqrt(8*S-1)-3)/2)))}else u=r.Math2.QGCD.apply(null,m);v(u)||i();for(g=0;g<h.length;g++){var F=h[g],x=F.power.clone().divide(u);F.multiplier=new p(Math.pow(F.multiplier,1/x)),F.power=u.clone(),s=e.add(s,F)}if(s.group!==l)return t;for(;;){var N=M.div(t.clone(),s.clone());if(!N[1].equals(0))break;if(t=N[0],n.add(s.clone()),t.equals(1))break}}catch(f){}return t},factor:function(t,n){if(t.group===l){var a=new d(0);t.each(function(r){(r.group===l&&r.power.greaterThan(1)||r.group===u)&&(r=e.expand(r)),a=e.add(a,r)}),a.power=t.power,t=a}t.group===o&&"sqrt"!==t.fname&&(t=r.Utils.evaluate(t));try{if(t.group===u){var s=!0;return(n=n||new w).add(new d(t.multiplier)),t.each(function(r){r.group!==i&&(s=!1);var e=M.Factor.factor(r.clone());n.add(e)}),s?t:n.toSymbol()}if(t.group===i)return t;if(t.isConstant())return t.equals(1)?t.clone():r.Math2.factor(t);var h=t.power.clone();if(v(h)){t.toLinear(),n=n||new w;var p={};t=e.parse(r.Utils.subFunctions(t,p)),f(p).length>0&&(n.preAdd=function(t){return e.parse(t,r.Utils.getFunctionsSubs(p))}),t.isLinear()||(n.pFactor=t.power.toString(),t.toLinear());var m=c(t);if(m.length>1){s=!0;var g=!0;if(t.each(function(r){r.group!==i&&(s=!1),r.multiplier.equals(1)||(g=!1)}),s&&g)return e.pow(t,e.parse(h))}if(t=M.Factor.coeffFactor(t,n),t=M.Factor.powerFactor(t,n),1===m.length){t=M.Factor.squareFree(t,n);var b=new w;t=M.Factor.trialAndError(t,b);for(var y in b.factors)n.add(e.pow(b.factors[y],e.parse(h)))}else t=M.Factor.mfactor(t,n);return t=e.parse(t,r.Utils.getFunctionsSubs(p)),n.add(e.pow(t,e.parse(h))),n.clean(),n.toSymbol()}return t}catch(r){return t}},reduce:function(r,t){if(r.group===l&&2===r.length){var n=r.collectSymbols().sort(function(r,e){return e.multiplier-r.multiplier});if(n[0].power.equals(n[1].power)){var i=e.parse(n[0].power),a=n[0].clone().toLinear(),o=n[1].clone().toLinear();t.add(e.add(a.clone(),o.clone())),o.negate();for(var s=Number(i),u=new d(0),f=1;f<=s;f++){var c=e.pow(a.clone(),e.subtract(i.clone(),new d(f))),h=e.pow(o.clone(),e.subtract(new d(f),new d(1)));u=e.add(u,e.multiply(c,h))}return u}}return r},squareFree:function(r,e){if(r.isConstant()||r.group===i)return r;var t=new b(r).squareFree(),n=t[2];if(1!==n){var a=t[1].toSymbol();return a.power=a.power.multiply(new p(n)),e.add(M.Factor.factor(a)),M.Factor.squareFree(t[0].toSymbol(),e)}return r},powerFactor:function(t,n){if(t.group!==s)return t;var i=r.Utils.arrayMin(f(t.symbols)),a=new d(0),o=e.parse(t.value+"^"+i);return t.each(function(r){r=e.divide(r,o.clone()),a=e.add(a,r)}),n.add(o),a},coeffFactor:function(e,t){if(e.isComposite()){var n=r.Math2.QGCD.apply(null,e.coeffs());n.equals(1)||e.each(function(r){r.isComposite()?r.each(function(r){r.multiplier=r.multiplier.divide(n)}):r.multiplier=r.multiplier.divide(n)}),e.updateHash(),t&&t.add(new d(n))}return e},trialAndError:function(e,t){if(e.isConstant()||e.group===i)return e;for(var n=new b(e),a=n.coeffs[0],o=r.Math2.ifactor(a),s=M.proots(e),l=0;l<s.length;l++){var u=s[l],f=1;if(!isNaN(u)){for(var c in o){var h=r.Utils.round(Math.log(c)/Math.log(Math.abs(u)),8);if(v(h)){u=c,f=h;break}}var d=new p(u),m=[new p(d.num).negate()];m[f]=new p(d.den);var g=b.fromArray(m,n.variable).fill(),w=n.divide(g);w[1].equalsNumber(0)&&(n=w[0],t.add(g.toSymbol()))}}return n.equalsNumber(1)||(n=M.Factor.search(n,t)),n.toSymbol()},search:function(e,t,n){n=n||10;var i=e.variable,a=function(r,a,o,s){var l=b.fit(r,a,o,n,s,i);if(l&&l.coeffs.length>1){var u=e.divide(l);if(u[1].equalsNumber(0))return t.add(l.toSymbol()),[u[0],l]}return null},o=e.coeffs[0],s=r.Math2.ifactor(o),l=e.lc(),u=r.Math2.ifactor(l),f=e.sub(n),c=M.Factor.mix(r.Math2.ifactor(f),f<0),h=Math.ceil(e.coeffs.length/2),p=l.lessThan(0),v=o.lessThan(0);for(u[1]=1,s[1]=1;h--;)for(var d in u)for(var m in s)for(var g=0;g<c.length;g++){var w=a(d,m,c[g],h);if(w)return e=w[0],r.Utils.isPrime(e.sub(n))||(e=M.Factor.search(e,t)),e;!w&&p?w=a(-d,m,c[g],h):!w&&v?w=a(d,-m,c[g],h):!w&&p&&v&&(w=a(-d,-m,c[g],h))}return e},mSqfrFactor:function(e,t){if(e.group!==o)for(var n=c(e).reverse(),i=0;i<n.length;i++)do{if(n[i]!==e.value){var a=M.Factor.coeffFactor(r.Calculus.diff(e,n[i]));if(a.equals(0))break;var s=M.div(e,a.clone()),l=s[1].equals(0);if(s[0].isConstant()){t.add(s[0]);break}l&&(t.add(s[0]),e=a)}else t.add(e),e=new d(1)}while(l);return e},sqdiff:function(t,n){try{var a,o,s=function(e){return r.Utils.block("POSITIVE_MULTIPLIERS",function(){return d.unwrapPARENS(g.sqrt(g.abs(e)))},!0)},l=r.Utils.separate(t.clone()),u=[];for(var f in l)"constants"!==f&&u.push(l[f]);if(u.sort(function(r,e){return e.power-r.power}),2===u.length)if(a=u.pop(),o=u.pop(),a.isComposite()&&o.power.equals(2)){o=s(o);var c=M.Factor.factor(e.add(a,l.constants));c.power.equals(2)&&(c.toLinear(),n.add(e.subtract(c.clone(),o.clone())),n.add(e.add(c,o)),t=new d(1))}else if(a=a.powSimp(),o=o.powSimp(),(a.group===i||""===a.fname)&&a.power.equals(2)&&(o.group===i||""===o.fname)&&o.power.equals(2)){if(a.multiplier.lessThan(0)){var h=o;o=a,a=h}a.multiplier.greaterThan(0)&&(a=s(a),o=s(o)),n.add(e.subtract(a.clone(),o.clone())),n.add(e.add(a,o)),t=new d(1)}}catch(r){}return t},mfactor:function(t,n){if(t.group===o)if("sqrt"===t.fname){var i=new w,a=M.Factor.common(t.args[0].clone(),i);a=M.Factor.coeffFactor(a,i),t=e.symfunction("sqrt",[a]),i.each(function(n){t=e.multiply(t,e.parse(r.Utils.format("sqrt({0})",n)))})}else n.add(t);else{t=M.Factor.mSqfrFactor(t,n);for(var s=c(t),l=t.collectSymbols().map(function(r){return d.unwrapSQRT(r)}),u={},f={},h=s.length,p=l.length,m=0;m<h;m++){var g=s[m];u[g]=new d(0);for(var b=0;b<p;b++){var y=l[b];if(y.contains(g)){var q=y.value===g?y.power.toDecimal():y.symbols[g].power.toDecimal();(!f[g]||q<f[g])&&(f[g]=q),u[g]=e.add(u[g],y.clone())}}}for(var S in u){var U=e.parse(S+"^"+f[S]),F=e.divide(u[S],U),x=e.expand(F);if(x.equals(1))break;var N=M.div(t.clone(),x);if(N[0].equals(0))break;var A=v(x)&&x.lessThan(0);if(N[1].equals(0)&&!A){var C=M.div(t.clone(),N[0].clone());U=C[0];if(t=C[1],U.equals(-1))return t;var E=N[0];if(t.equals(E)){var k=M.Factor.reduce(E,n);if(!t.equals(k))return M.Factor.mfactor(k,n)}else n.add(E);return U.isConstant("all")?(n.add(U),U):M.Factor.mfactor(U,n)}}}return t=M.Factor.sqdiff(t,n),t=M.Factor.zeroes(t,n)}},allLinear:function(r){for(var e=r.length,t=0;t<e;t++)if(!M.isLinear(r[t]))return!1;return!0},isLinear:function(r){var e=!1,n=r.group;if(n===s||n===l){e=!0;for(var f in r.symbols){var c=r.symbols[f],h=c.group;if(h===o||h===a||h===u)e=!1;else if(h===s||h===l)e=M.isLinear(c);else if(c.group!==t&&"1"!==c.power.toString()){e=!1;break}}}else n===i&&1===r.power&&(e=!0);return e},gcd:function(){var t;if(0==(t=1===arguments.length&&arguments[0]instanceof r.Vector?arguments[0].elements:r.Utils.arguments2Array(arguments)).length)return new d(1);if(1==t.length)return t[0];for(var n=[],i=!1,a=0;a<t.length;a++)if(t[a].group===o&&"gcd"===t[a].fname)(t=t.concat(arguments[a].args)).splice(a,1);else{var s=c(t[a]);if(r.Utils.haveIntersection(s,n)){i=!0;break}n=n.concat(s)}if(i||0===n.length){if(t.every(function(r){return r.getDenom().equals(1)})){var l=t[0];for(a=1;a<t.length;a++)l=M.gcd_(t[a],l);return l}return e.divide(M.gcd.apply(null,t.map(function(r){return r.getNum()})),M.lcm.apply(null,t.map(function(r){return r.getDenom()})))}return e.symfunction("gcd",t)},gcd_:function(t,i){if(t.group!==o&&t.group!==n||(t=r.Utils.block("PARSE2NUMBER",function(){return e.parse(t)})),i.group===o&&(i=r.Utils.block("PARSE2NUMBER",function(){return e.parse(i)})),t.isConstant()&&i.isConstant())return new d(r.Math2.QGCD(new p(+t),new p(+i)));var s=e.multiply(t.getDenom()||new d(1),i.getDenom()||new d(1)).invert();if(t=e.multiply(t.clone(),s.clone()),i=e.multiply(i.clone(),s.clone()),t=e.expand(t),i=e.expand(i),t.group===u||i.group===u){var l=e.divide(t.clone(),i.clone());if(!(g=e.multiply(i.clone(),l.getDenom().invert())).equals(1))return g}if(t.group===a||i.group===a){var f=new d(r.Math2.GCD(t.multiplier,i.multiplier)),h=M.gcd_(t.value===m?new d(1):e.parse(t.value),i.value===m?new d(1):e.parse(i.value)),v=M.gcd_(e.parse(t.power),e.parse(i.power));return e.multiply(f,e.pow(h,v))}if(t.length<i.length){var g=t;t=i,i=g}var w,y=c(t),q=c(i);if(y.length===q.length&&1===y.length&&y[0]===q[0]||1===y.length&&0===q.length||0===y.length&&1===q.length)return t=new b(t),i=new b(i),e.divide(t.gcd(i).toSymbol(),s);for(;!i.equals(0);){g=i.clone();if(t=t.clone(),w=M.div(t,g),i=w[1],w[0].equals(0))return e.divide(new d(r.Math2.QGCD(t.multiplier,i.multiplier)),s);t=g}var S=[];t.each(function(r){S.push(r.multiplier)});var U=r.Math2.QGCD.apply(void 0,S);return U.equals(1)||t.each(function(r){r.multiplier=r.multiplier.divide(U)}),!t.equals(1)||t.isConstant()||i.isConstant()?e.divide(t,s):e.divide(e.symfunction("gcd",arguments),s)},lcm:function(){var t;1===arguments.length?arguments[0]instanceof r.Vector?t=arguments[0].elements:e.error("lcm expects either 1 vector or 2 or more arguments"):t=r.Utils.arguments2Array(arguments);var n=t.reduce(function(r,t){return e.multiply(r,t.clone())},new d(1)),i=function(r,e){var t,n,i,a=[],o=Math.pow(2,r.length);for(n=e;n<o;n++){t=[],i=r.length-1;do{0!=(n&1<<i)&&t.push(r[i])}while(i--);t.length==e&&a.push(t)}return a}(arguments,arguments.length-1).map(function(r){return r.reduce(function(r,t){return e.multiply(r,t.clone())},new d(1))});if(t.every(function(e){return r.Utils.isVariableSymbol(e)}))var a=e.symfunction("gcd",r.Utils.arrayUnique(i));else a=M.gcd.apply(null,i);return e.divide(n,a)},divide:function(t,n){var i,a,o,s;return(s=(o=r.Algebra.Factor.factor(t.clone())).getDenom()).isConstant("all")?s=new d(1):t=e.expand(d.unwrapPARENS(e.multiply(o,s.clone()))),i=M.div(t,n),a=e.divide(i[1],n),e.divide(e.add(i[0],a),s)},div:function(t,n){if(n.isConstant())return t.each(function(r){r.multiplier=r.multiplier.divide(n.multiplier)}),[t,new d(0)];if(t.group===i&&n.group===l){var a=t.value,o=r.Utils.decompose_fn(n.clone(),a,!0);if(t.isLinear()&&o.x&&o.x.isLinear()&&n.isLinear()){var s=d.create(t.multiplier);return[e.divide(s.clone(),o.a.clone()),e.divide(e.multiply(s,o.b),o.a).negate()]}}if(t.group===i&&n.group===i){var u=e.divide(t.clone(),n.clone());return u.isConstant()?[u,new d(0)]:[new d(0),t.clone()]}var f=t.hasFunc(),h=n.hasFunc(),v=!1;if(f||h){v=!0;var g={},w=(t=e.parse(r.Utils.subFunctions(t,g)),n=e.parse(r.Utils.subFunctions(n,g)),r.Utils.getFunctionsSubs(g))}var M,q,S,U,F=r.Utils.arrayUnique(c(t).concat(c(n)));if(1===F.length){M=(Q=new b(t).divide(new b(n)))[0].toSymbol(),q=Q[1].toSymbol()}else{F.push(m);var x=function(r){for(var t=new d(0),n=0;n<r.length;n++){var i=r[n].toSymbol();t=e.add(t,i)}return t},N=function(r,e){var t,n=Math.max.apply(null,r.terms),i=0;if(!e)for(var a=0;a<r.terms.length;a++)if(r.terms[a].equals(n)&&(t=a,i++),i>1)return;if(e)for(a=0;a<r.terms.length;a++)if(r.terms[a].equals(n)){t=a;break}return[n,t,r]},A=function(r,e){var t=r[e=e||0],n=r.length;if(t){for(var i,a,o=N(t),s=e+1;s<n;s++){var l=r[s],u=t.sum.equals(l.sum);if(!u&&o)break;if(u){for(var f,c,h,p,v=t.terms.length,d=0;d<v;d++){var m=t.terms[d],g=l.terms[d];(void 0===f||m.greaterThan(f))&&(f=m,h=d),(void 0===c||g.greaterThan(c))&&(c=g,p=d)}var b=f.subtract(l.terms[h]),w=c.subtract(t.terms[p]);if(w>b){o=[c,p,l];break}if(b>w){o=[f,h,t];break}}else if(o=N(l))break;o=N(l)}if(!o)return N(r[0],!0);for(s=0;s<P.length;s++){var y=P[s].terms;if((a=o[1])===y.length-1)return;if(!(i=y[a]).equals(0))break}return i.equals(0)?A(r,++e):o}},C=r.Utils.toMapObj(F),E=function(r,e){return e.sum.subtract(r.sum)},k=function(r,e){if(!r||!e)return!1;for(var t=0;t<r.terms.length;t++)if(r.terms[t].lessThan(e.terms[t]))return!1;return!0},D=t.tBase(C).sort(E),P=n.tBase(C).sort(E),T=k(D[0],P[0])&&D[0].count>P[0].count?P:D,L=A(T),R=[];if(L){var z=L[1],V=function(r,e){var t=r.len(),n=e.len(),i=e.terms[z],a=r.terms[z];return n>t&&i.greaterThan(a)?n-t:i.subtract(a)};z=z,D.sort(V),P.sort(V);var _=P[0],I=D[0],j=new y(new p(1),[],I.map);if(_.sum.greaterThan(I.sum)&&I.len()>1)for(var O=0;O<I.terms.length;O++){var Z=_.terms[O].subtract(I.terms[O]);if(Z.equals(0))j.terms[O]=new p(0);else{var B=Z.add(new p(1));j.terms[O]=Z;for(var G=0;G<D.length;G++)D[G].terms[O]=D[G].terms[O].add(B)}}for(var H=k(D[0],P[0]);H&&(U=P,!(S=D)[0].sum.equals(U[0].sum)||S.length>=U.length);){var Q=D[0].divide(P[0]);R.push(Q),D.shift();for(O=1;O<P.length;O++){var X=P[O].multiply(Q).generateImage(),Y=D.length;0===Y&&(X.coeff=X.coeff.neg(),D.push(X),D.sort(V));for(G=0;G<Y;G++){var J=D[G];if(J.getImg()===X.getImg()){J.coeff=J.coeff.subtract(X.coeff),J.coeff.equals(0)&&(r.Utils.remove(D,G),G--);break}G===Y-1&&(X.coeff=X.coeff.neg(),D.push(X),D.sort(V))}}if(!(H=k(D[0],P[0]))&&D.length>=P.length)for(O=1;O<D.length;O++)if(H=k(D[O],P[0])){D.unshift(r.Utils.remove(D,O));break}}}M=x(R),q=x(D),void 0!==j&&(j=j.toSymbol(),M=e.divide(M,j.clone()),q=e.divide(q,j))}return v&&(M=e.parse(M.text(),w),q=e.parse(q.text(),w)),[M,q]},line:function(t,n,i){r.Utils.isArray(t)&&(t=r.Utils.convertToVector(t)),r.Utils.isArray(n)&&(n=r.Utils.convertToVector(n)),i=e.parse(i||"x"),r.Utils.isVector(t)&&r.Utils.isVector(n)||e.error('Line expects a vector! Received "'+t+'" & "'+n+'"');var a=e.subtract(n.e(1).clone(),t.e(1).clone()),o=e.subtract(n.e(2).clone(),t.e(2).clone()),s=e.divide(o,a),l=e.multiply(i,s.clone()),u=e.multiply(t.e(1).clone(),s);return e.add(e.subtract(l,u),t.e(2).clone())},PartFrac:{createTemplate:function(r,t,n,a){var s,l,u,f,c,h,p;(r=M.Factor.factor(r)).each(function(e,t){if(e.group===o&&""===e.fname&&e.args[0].group===i){var n=e.args[0];this.symbols?(delete this.symbols[t],this.symbols[n.value]=n):r=e.args[0]}}),s=t.collectFactors(),l=[],h=[],p=new d(1);for(var v=0;v<s.length;v++){var m=d.unwrapPARENS(s[v]);if(m.power.greaterThan(1)){f=Number(m.power),u=m.clone().toLinear(),c=Number(M.degree(u,a));for(var g=0;g<f;g++){var b=e.pow(u.clone(),new d(g+1));n.push(b.clone());var w=e.divide(r.clone(),b.clone());h.push(c),l.push(w)}}else if(m.isConstant("all"))p=e.multiply(p,m);else{c=Number(M.degree(m,a)),n.push(m);w=e.divide(r.clone(),m.clone());w=e.expand(d.unwrapPARENS(w)),h.push(c),l.push(w)}}return[n=n.map(function(r){return e.multiply(r,p.clone())}),l,h]},partfrac:function(t,n,i){var a=c(t);n=n||e.parse(a[0]);try{var o,s,l,u,f,h,p,v,m,g,b,w,y,q,S,U,F,x,N;if(o=e.expand(t.getNum()),s=e.expand(t.getDenom().toUnitMultiplier()),o.multiplier=t.multiplier,f=o.groupTerms(n),Number(M.degree(o,n))>=Number(M.degree(s,n))?(y=(w=M.div(o.clone(),e.expand(s.clone())))[0],f=(o=w[1]).groupTerms(n)):y=new d(0),1===Number(M.degree(s,n))){var A=e.divide(o,s);return i?[y,A]:e.add(y,A)}u=M.Factor.factor(s),U=M.PartFrac.createTemplate(s.clone(),u,[],n),F=U[0],q=U[1],h=U[2],b=[f.length],p=[],l=[],S=[],q.map(function(r,t){x=F[t],N=h[t];for(var i=0;i<N;i++){l.push(x.clone());var a=d.create(n,i),o=e.expand(e.multiply(r,a.clone())).groupTerms(n),s=o.length;b.push(s),p.push(o),S.push(a.clone())}}),v=r.Utils.arrayMax(b),g=new r.Matrix(r.Utils.fillHoles(f,v)).transpose(),m=new r.Matrix;for(var C=0;C<p.length;C++)m.elements.push(r.Utils.fillHoles(p[C],v));var E=e.multiply(m.transpose().invert(),g),k=i?[y]:y;return E.each(function(r,t){var n=e.multiply(S[t],e.divide(r,l[t]));i?k.push(n):k=e.add(k,n)}),k}catch(r){}return t}},degree:function(t,n,o){if(o=o||{nd:[],sd:[],depth:0},!n){var s=c(t);if(s.length>1)throw new Error("You must specify the variable for multivariate polynomials!");if(0===s.length)return new d(0);n=e.parse(s[0])}var l=t.group;t.isComposite()?((t=t.clone()).distributeExponent(),t.each(function(r){o.depth++,M.degree(r,n,o),o.depth--})):t.group===u?t.each(function(r){o.depth++,M.degree(r,n,o),o.depth++}):l===a&&t.value===n.value?o.sd.push(t.power.clone()):l===i&&t.value===n.value?o.nd.push(e.parse(t.power)):o.nd.push(new d(0));var f=o.nd.length>0?r.Utils.arrayMax(o.nd):void 0;return 0===o.depth&&o.sd.length>0?(void 0!==f&&o.sd.unshift(f),e.symfunction("max",o.sd)):(r.Utils.isSymbol(f)||(f=e.parse(f)),f)},sqComplete:function(t,n,i){r.Utils.isSymbol(n)||(n=e.parse(n));var a,o,s,u,f,c,h,p,v,m,b,w=function(r){throw r=r||"Stopping",new Error(r)};return t.group!==l&&w("Must be a polynomial!"),v=r.Utils.inBrackets,t=t.clone(),(a=r.Algebra.degree(t,n)).equals(2)||w("Cannot complete square for degree "+a),o=(h=r.Algebra.coeffs(t,n))[2],p=h[1].sign(),s=e.divide(h[1],new d(2)),u=e.pow(s.clone(),new d(2)),i?[o,s,f]:(b=g.sqrt(o),c=e.divide(g.sqrt(u),b.clone()),f=e.subtract(h[0],e.pow(c.clone(),new d(2))),{a:m=e.parse(v(b.clone()+"*"+n+(p<0?"-":"+")+c)),c:f,f:e.add(e.pow(m.clone(),new d(2)),f.clone())})},Classes:{Polynomial:b,Factors:w,MVTerm:y}};nerdamer.useAlgebraDiv=function(){var t=M.divideFn=e.divide,n=0;e.divide=function(e,i){var a;return a=1===++n?r.Algebra.divide(e,i):t(e,i),n=0,a}},nerdamer.useParserDiv=function(){M.divideFn&&(e.divide=M.divideFn),delete M.divideFn},nerdamer.register([{name:"factor",visible:!0,numargs:1,build:function(){return M.Factor.factor}},{name:"gcd",visible:!0,numargs:[1],build:function(){return M.gcd}},{name:"lcm",visible:!0,numargs:[1],build:function(){return M.lcm}},{name:"roots",visible:!0,numargs:-1,build:function(){return M.roots}},{name:"divide",visible:!0,numargs:2,build:function(){return M.divide}},{name:"div",visible:!0,numargs:2,build:function(){return M.div}},{name:"partfrac",visible:!0,numargs:[1,2],build:function(){return M.PartFrac.partfrac}},{name:"deg",visible:!0,numargs:[1,2],build:function(){return M.degree}},{name:"coeffs",visible:!0,numargs:[1,2],build:function(){return function(){var e=M.coeffs.apply(M,arguments);return new r.Vector(e)}}},{name:"line",visible:!0,numargs:[2,3],build:function(){return M.line}},{name:"sqcomp",visible:!0,numargs:[1,2],build:function(){return function(r,e){try{return e=e||c(r)[0],M.sqComplete(r.clone(),e).f}catch(e){return r}}}}]),nerdamer.api()}();
