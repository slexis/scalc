!function(){var t,e=window.jQuery,n="mathquill-command-id",i="mathquill-block-id",s=Math.min,r=Math.max;function o(){}var a=[].slice;function l(t){var e=t.length-1;return function(){var n=a.call(arguments,0,e),i=a.call(arguments,e);return t.apply(this,n.concat([i]))}}var c=l(function(t,e){return l(function(n,i){if(t in n)return n[t].apply(n,e.concat(i))})});function h(t){return l(function(e,n){"function"!=typeof e&&(e=c(e));return t.call(this,function(t){return e.apply(t,[t].concat(n))})})}function u(t){var e=a.call(arguments,1);return function(){return t.apply(this,e)}}function f(t,e){if(!e)throw new Error("prayer failed: "+t)}var p=function(t,e,n){function i(t){return"object"==typeof t}function s(t){return"function"==typeof t}function r(){}return function n(o,a){function l(){var t=new c;return s(t.init)&&t.init.apply(t,arguments),t}function c(){}void 0===a&&(a=o,o=Object),l.Bare=c;var h,u=r[t]=o[t],f=c[t]=l[t]=l.p=new r;return f.constructor=l,l.mixin=function(e){return c[t]=l[t]=n(l,e)[t],l},(l.open=function(t){if(h={},s(t)?h=t.call(l,f,u,l,o):i(t)&&(h=t),i(h))for(var n in h)e.call(h,n)&&(f[n]=h[n]);return s(f.init)||(f.init=o),l})(a)}}("prototype",{}.hasOwnProperty),d=-1,m=1;function g(t){f("a direction was passed",t===d||t===m)}var v=p(e,function(t){t.insDirOf=function(t,e){return t===d?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===d?this.prependTo(e):this.appendTo(e)}}),b=p(function(t){t.parent=0,t[d]=0,t[m]=0,t.init=function(t,e,n){this.parent=t,this[d]=e,this[m]=n},this.copy=function(t){return b(t.parent,t[d],t[m])}}),w=p(function(t){t[d]=0,t[m]=0,t.parent=0;var e=0;this.byId={},t.init=function(){this.id=e+=1,w.byId[this.id]=this,this.ends={},this.ends[d]=0,this.ends[m]=0},t.dispose=function(){delete w.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=v(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){t=v(t||this.html());function e(t){if(t.getAttribute){var n=t.getAttribute("mathquill-command-id"),i=t.getAttribute("mathquill-block-id");n&&w.byId[n].jQadd(t),i&&w.byId[i].jQadd(t)}for(t=t.firstChild;t;t=t.nextSibling)e(t)}for(var n=0;n<t.length;n++)e(t[n]);return t},t.createDir=function(t,e){g(t);return this.jQize(),this.jQ.insDirOf(t,e.jQ),e[t]=this.adopt(e.parent,e[d],e[m]),this},t.createLeftOf=function(t){return this.createDir(d,t)},t.selectChildren=function(t,e){return Q(t,e)},t.bubble=h(function(t){for(var e=this;e;e=e.parent){if(!1===t(e))break}return this}),t.postOrder=h(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[d]&&0===this.ends[m]},t.children=function(){return x(this.ends[d],this.ends[m])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return x(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return x(this,this).adopt(t,e,n),this},t.disown=function(){return x(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}});function q(t,e,n){f("a parent is always present",t),f("leftward is properly set up",e?e[m]===n&&e.parent===t:t.ends[d]===n),f("rightward is properly set up",n?n[d]===e&&n.parent===t:t.ends[m]===e)}var x=p(function(e){e.init=function(e,n,i){if(i===t&&(i=d),g(i),f("no half-empty fragments",!e==!n),this.ends={},e){f("withDir is passed to Fragment",e instanceof w),f("oppDir is passed to Fragment",n instanceof w),f("withDir and oppDir have the same parent",e.parent===n.parent),this.ends[i]=e,this.ends[-i]=n;var s=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(s)}},e.jQ=v(),e.withDirAdopt=function(t,e,n,i){return t===d?this.adopt(e,n,i):this.adopt(e,i,n)},e.adopt=function(t,e,n){q(t,e,n);var i=this;i.disowned=!1;var s=i.ends[d];if(!s)return this;var r=i.ends[m];return e||(t.ends[d]=s),n?n[d]=r:t.ends[m]=r,i.ends[m][m]=n,i.each(function(n){n[d]=e,n.parent=t,e&&(e[m]=n),e=n}),i},e.disown=function(){var t=this,e=t.ends[d];if(!e||t.disowned)return t;t.disowned=!0;var n=t.ends[m],i=e.parent;return q(i,e[d],e),q(i,n,n[m]),e[d]?e[d][m]=n[m]:i.ends[d]=n[m],n[m]?n[m][d]=e[d]:i.ends[m]=e[d],t},e.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},e.each=h(function(t){var e=this.ends[d];if(!e)return this;for(;e!==this.ends[m][m];e=e[m]){if(!1===t(e))break}return this}),e.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),y={},O={},k=p(b,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=v('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[m]?this.selection&&this.selection.ends[d][d]===this[d]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[m].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.click()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=v(),this},t.withDirInsertAt=function(t,e,n,i){var s=this.parent;this.parent=e,this[t]=n,this[-t]=i,s!==e&&s.blur&&s.blur()},t.insDirOf=function(t,e){return g(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(d,t)},t.insRightOf=function(t){return this.insDirOf(m,t)},t.insAtDirEnd=function(t,e){return g(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.click(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(d,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(m,t)},t.jumpUpDown=function(t,e){var n=this;n.upDownCache[t.id]=b.copy(n);var i=n.upDownCache[e.id];if(i)i[m]?n.insLeftOf(i[m]):n.insAtRightEnd(i.parent);else{var s=n.offset().left;e.seek(s,n)}},t.offset=function(){var t=this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),t},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[m],i=t[d];if(t.disown().eachChild(function(s){s.isEmpty()||(s.children().adopt(e,i,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),i=s.ends[m])}),!this[m])if(this[d])this[m]=this[d][m];else for(;!this[m];){if(this.parent=this.parent[m],!this.parent){this[m]=t[m],this.parent=e;break}this[m]=this.parent.ends[d]}this[m]?this.insLeftOf(this[m]):this.insAtRightEnd(e),t.jQ.remove(),t[d].siblingDeleted&&t[d].siblingDeleted(this.options,m),t[m].siblingDeleted&&t[m].siblingDeleted(this.options,d)},t.startSelection=function(){for(var t=this.anticursor=b.copy(this),e=t.ancestors={},n=t;n.parent;n=n.parent)e[n.parent.id]=n},t.endSelection=function(){delete this.anticursor},t.select=function(){var t=this.anticursor;if(this[d]===t[d]&&this.parent===t.parent)return!1;for(var e=this;e.parent;e=e.parent)if(e.parent.id in t.ancestors){var n=e.parent;break}f("cursor and anticursor in the same tree",n);var i,s,r=t.ancestors[n.id],o=m;if(e[d]!==r)for(var a=e;a;a=a[m])if(a[m]===r[m]){o=d,i=e,s=r;break}return o===m&&(i=r,s=e),i instanceof b&&(i=i[m]),s instanceof b&&(s=s[d]),this.hide().selection=n.selectChildren(i,s),this.insDirOf(o,this.selection.ends[o]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[d]=this.selection.ends[d][d],this[m]=this.selection.ends[m][m],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[d]=t.ends[d][d],this[m]=t.ends[m][m],delete this.selection),t}}),Q=p(x,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),T=p(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,t.controller=this,this.cursor=t.cursor=k(t,n)},t.handle=function(t,e){var n=this.options.handlers;if(n&&n.fns[t]){var i=n.APIClasses[this.KIND_OF_MQ](this);e===d||e===m?n.fns[t](e,i):n.fns[t](i)}};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t++)e[t].apply(this.cursor,arguments);return this}}),j={},C=p(),D={},_=p(),S={};function E(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function L(t){return E(),It(t)}L.prototype=_.p,L.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return(E=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')})(),L},L.getInterface=I;var A=I.MIN=1,R=I.MAX=2;function I(t){if(!(A<=t&&t<=R))throw"Only interface versions between "+A+" and "+R+" supported. You specified: "+t;function e(t){if(!t||!t.nodeType)return null;var e=v(t).children(".mq-root-block").attr(i),s=e&&w.byId[e].controller;return s?n[s.KIND_OF_MQ](s):null}var n={};function s(t,e){e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:n});for(var i in e)if(e.hasOwnProperty(i)){var s=e[i],r=D[i];t[i]=r?r(s):s}}e.L=d,e.R=m,e.config=function(t){return s(C.p,t),this},e.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";S[t]=e};var r=n.AbstractMathQuill=p(_,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e=this.__controller,n=e.root,s=e.container;e.createTextarea();var r=s.addClass(t).contents().detach();n.jQ=v('<span class="mq-root-block"/>').attr(i,n.id).appendTo(s),this.latex(r.text()),this.revert=function(){return s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(r)}},t.config=function(t){return s(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}});e.prototype=r.prototype,n.EditableField=p(r,function(t,e){t.__mathquillify=function(){return e.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},t.click=function(){return this.__controller.textarea.click(),this},t.blur=function(){return this.__controller.textarea.blur(),this},t.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},t.cmd=function(t){var e=this.__controller.notify(),n=e.cursor;if(/^\\[a-z]+$/i.test(t)){t=t.slice(1);var i=y[t];i&&(t=i(t),n.selection&&t.replaces(n.replaceSelection()),t.createLeftOf(n.show()),this.__controller.scrollHoriz())}else n.parent.write(n,t);return e.blurred&&n.hide().parent.blur(),this},t.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[d];)t.selectLeft();return this},t.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},t.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},t.moveToLeftEnd=function(){return this.moveToDirEnd(d)},t.moveToRightEnd=function(){return this.moveToDirEnd(m)},t.keystroke=function(t){t=t.replace(/^\s+|\s+$/g,"").split(/\s+/);for(var e=0;e<t.length;e++)this.__controller.keystroke(t[e],{preventDefault:o});return this},t.typedText=function(t){for(var e=0;e<t.length;e++)this.__controller.typedText(t.charAt(e));return this},t.dropEmbedded=function(t,e,n){var i=t-v(window).scrollLeft(),s=e-v(window).scrollTop(),r=document.elementFromPoint(i,s);this.__controller.seek(v(r),t,e),Rt().setOptions(n).createLeftOf(this.__controller.cursor)}}),e.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},e.EditableField.prototype=n.EditableField.prototype;for(var a in j)!function(i,s){var r=n[i]=s(n);e[i]=function(n,s){var o=e(n);if(o instanceof r||!n||!n.nodeType)return o;var a=T(r.RootBlock(),v(n),C());return a.KIND_OF_MQ=i,r(a).__mathquillify(s,t)},e[i].prototype=r.prototype}(a,j[a]);return e}L.noConflict=function(){return window.MathQuill=z,L};var z=window.MathQuill;function M(t){for(var e="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "),n=0;n<e.length;n++)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(e[n]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}window.MathQuill=L;var B=p(function(t,e,n){function i(t,e){throw"Parse Error: "+e+" at "+(t=t?"'"+t+"'":"EOF")}t.init=function(t){this._=t},t.parse=function(t){return this.skip(o)._(""+t,function(t,e){return e},i)},t.or=function(t){f("or is passed a parser",t instanceof n);var e=this;return n(function(n,i,s){return e._(n,i,function(e){return t._(n,i,s)})})},t.then=function(t){var e=this;return n(function(i,s,r){return e._(i,function(e,i){var o=t instanceof n?t:t(i);return f("a parser is returned",o instanceof n),o._(e,s,r)},r)})},t.many=function(){var t=this;return n(function(e,n,i){for(var s=[];t._(e,r,o););return n(e,s);function r(t,n){return e=t,s.push(n),!0}function o(){return!1}})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,s,r){for(var o,a=[],l=!0,c=0;c<t;c++)if(!(l=i._(n,h,u)))return r(n,o);for(;c<e&&l;c++)l=i._(n,h,f);return s(n,a);function h(t,e){return a.push(e),n=t,!0}function u(t,e){return o=e,n=t,!1}function f(t,e){return!1}})},t.result=function(t){return this.then(r(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return r(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})};this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,s,r){var o=n.slice(0,e);return o===t?s(n.slice(e),o):r(n,i)})};var s=this.regex=function(t){f("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,i,s){var r=t.exec(n);if(r){var o=r[0];return i(n.slice(o.length),o)}return s(n,e)})},r=n.succeed=function(t){return n(function(e,n){return n(e,t)})},o=(n.fail=function(t){return n(function(e,n,i){return i(e,t)})},n.letter=s(/^[a-z]/i),n.letters=s(/^[a-z]*/i),n.digit=s(/^[0-9]/),n.digits=s(/^[0-9]*/),n.whitespace=s(/^\s+/),n.optWhitespace=s(/^\s*/),n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),n.all=n(function(t,e,n){return e("",t)}),n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)}))}),F=function(){var t={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){var s,r=null,a=null,l=e(n),c=e(i.container||l),h=o;function u(t){h=t,clearTimeout(s),s=setTimeout(t)}c.bind("keydown keypress input keyup clickout paste",function(t){h(t)});var f=!1;function p(){var e,n,s,o,a;i.keystroke((s=(e=r).which||e.keyCode,o=t[s],a=[],e.ctrlKey&&a.push("Ctrl"),e.originalEvent&&e.originalEvent.metaKey&&a.push("Meta"),e.altKey&&a.push("Alt"),e.shiftKey&&a.push("Shift"),n=o||String.fromCharCode(s),a.length||o?(a.push(n),a.join("-")):n),r)}function d(){if(!("selectionStart"in(t=l[0])&&t.selectionStart!==t.selectionEnd)){var t,e=l.val();1===e.length?(l.val(""),i.typedText(e)):e&&l[0].select&&l[0].select()}}function m(){var t=l.val();l.val(""),t&&i.paste(t)}return c.bind({keydown:function(t){r=t,a=null,f&&u(function(t){t&&"clickout"===t.type||!l[0].select||l[0].select(),h=o,clearTimeout(s)}),p()},keypress:function(t){r&&a&&p(),a=t,u(d)},clickout:function(){r=a=null},paste:function(t){l.click(),u(m)}}),{select:function(t){h(),h=o,clearTimeout(s),l.val(t),t&&l[0].select&&l[0].select(),f=!!t}}}}();T.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),T.open(function(t){t.clickBlurEvents=function(){var t,e=this,n=e.root,i=e.cursor;function s(){clearTimeout(t),i.selection&&i.selection.jQ.addClass("mq-blur"),r()}function r(){i.hide().parent.blur(),e.container.removeClass("mq-clicked"),v(window).off("blur",s)}e.textarea.click(function(){e.blurred=!1,clearTimeout(t),e.container.addClass("mq-clicked"),i.parent||i.insAtRightEnd(n),i.selection?(i.selection.jQ.removeClass("mq-blur"),e.selectionChanged()):i.show()}).blur(function(){e.blurred=!0,t=setTimeout(function(){n.postOrder("intentionalBlur"),i.clearSelection().endSelection(),r()}),v(window).on("blur",s)}),e.blurred=!0,i.hide().parent.blur()}}),T.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),w.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(d);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(m,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(d,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[m];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[m]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[d];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[d]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[d])for(;i[d];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[m])for(;i[m];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(m);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[d];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){f("overridden or never called on this node")}}),T.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",s=e+"OutOf";return n[m][i]?n.insAtLeftEnd(n[m][i]):n[d][i]?n.insAtRightEnd(n[d][i]):n.parent.bubble(function(t){var e=t[s];if(e&&("function"==typeof e&&(e=t[s](n)),e instanceof w&&n.jumpUpDown(t,e),!0!==e))return!1}),t}this.onNotify(function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()}),t.escapeDir=function(t,e,n){g(t);var i=this.cursor;if(i.parent!==this.root&&n.preventDefault(),i.parent!==this.root)return i.parent.moveOutOf(t,i),this.notify("move")},D.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){g(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(d)},t.moveRight=function(){return this.moveDir(m)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){g(t);var e=this.cursor,n=e.selection;return this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[d].siblingDeleted&&e[d].siblingDeleted(e.options,m),e[m].siblingDeleted&&e[m].siblingDeleted(e.options,d),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){g(t);var e=this.cursor;return!e[d]||e.selection?ctrlr.deleteDir():(this.notify("edit"),x(e.parent.ends[d],e[d]).remove(),e.insAtDirEnd(d,e.parent),e[d].siblingDeleted&&e[d].siblingDeleted(e.options,m),e[m].siblingDeleted&&e[m].siblingDeleted(e.options,d),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(d)},t.deleteForward=function(){return this.deleteDir(m)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e=this.notify("select").cursor,n=e.selection;g(t),e.anticursor||e.startSelection();var i=e[t];i?n&&n.ends[t]===i&&e.anticursor[-t]!==i?i.unselectInto(t,e):i.selectTowards(t,e):e.parent.selectOutOf(t,e),e.clearSelection(),e.select()||e.show()},t.selectLeft=function(){return this.selectDir(d)},t.selectRight=function(){return this.selectDir(m)}});var $=function(){function t(t){for(var e=t[0]||G(),n=1;n<t.length;n++)t[n].children().adopt(e,e.ends[m],0);return e}var e=B.string,n=B.regex,i=B.letter,s=B.any,r=B.optWhitespace,o=B.succeed,a=B.fail,l=i.map(function(t){return nt(t)}),c=n(/^[^${}\\_^]/).map(function(t){return W(t)}),h=n(/^[^\\a-eg-zA-Z]/).or(e("\\").then(n(/^[a-z]+/i).or(n(/^\s+/).result(" ")).or(s))).then(function(t){var e=y[t];return e?e(t).parser():a("unknown command: \\"+t)}).or(l).or(c),u=e("{").then(function(){return p}).skip(e("}")),f=r.then(u.or(h.map(function(t){var e=G();return t.adopt(e,0,0),e}))),p=f.many().map(t).skip(r),d=e("[").then(f.then(function(t){return"]"!==t.join("latex")?o(t):a()}).many().map(t).skip(r)).skip(e("]")),g=p;return g.block=f,g.optBlock=d,g}();T.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.writeLatex=function(t){var e=this.notify("edit").cursor,n=B.all,i=B.eof,s=$.skip(i).or(n.result(!1)).parse(t);s&&!s.isEmpty()&&(s.children().adopt(e.parent,e[d],e[m]),s.jQize().insertBefore(e.jQ),e[d]=s.ends[m],s.finalizeInsert(e.options,e),s.ends[m][m].siblingCreated&&s.ends[m][m].siblingCreated(e.options,d),s.ends[d][d].siblingCreated&&s.ends[d][d].siblingCreated(e.options,m),e.parent.bubble("reflow"));return this},t.renderLatexMath=function(t){var e=this.root,n=this.cursor,i=B.all,s=B.eof,r=$.skip(s).or(i.result(!1)).parse(t);e.eachChild("postOrder","dispose"),e.ends[d]=e.ends[m]=0,r&&r.children().adopt(e,0,0);var o=e.jQ;if(r){var a=r.join("html");o.html(a),e.jQize(o.children()),e.finalizeInsert(n.options)}else o.empty();delete n.selection,n.insAtRightEnd(e)},t.renderLatexText=function(t){var e=this.root,n=this.cursor;e.jQ.children().slice(1).remove(),e.eachChild("postOrder","dispose"),e.ends[d]=e.ends[m]=0,delete n.selection,n.show().insAtRightEnd(e);var i=B.regex,s=B.string,r=B.eof,o=B.all,a=s("$").then($).skip(s("$").or(r)).map(function(t){var e=V(n);e.createBlocks();var i=e.ends[d];return t.children().adopt(i,0,0),e}),l=s("\\$").result("$").or(i(/^[^$]/)).map(W),c=a.or(l).many().skip(r).or(o.result(!1)).parse(t);if(c){for(var h=0;h<c.length;h++)c[h].adopt(e,e.ends[m],0);e.jQize().appendTo(e.jQ),e.finalizeInsert(n.options)}}}),T.open(function(e){e.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",function(n){var s,r=v(n.target).closest(".mq-root-block"),a=w.byId[r.attr(i)||e.attr(i)].controller,l=a.cursor,c=l.blink,h=a.textareaSpan,u=a.textarea;function f(t){s=v(t.target)}function p(e){l.anticursor||l.startSelection(),a.seek(s,e.pageX,e.pageY).cursor.select(),s=t}a.blurred&&(a.editable||r.prepend(h),u.click()),n.preventDefault(),n.target.unselectable=!0,l.blink=o,a.seek(v(n.target),n.pageX,n.pageY).cursor.startSelection(),r.mousemove(f),v(n.target.ownerDocument).mousemove(p).mouseup(function t(e){l.blink=c,l.selection||(a.editable?l.show():h.detach()),r.unbind("mousemove",f),v(e.target.ownerDocument).unbind("mousemove",p).unbind("mouseup",t)})})}}),T.open(function(t){t.seek=function(t,e,s){var r=this.notify("select").cursor;if(t){var o=t.attr(i)||t.attr(n);if(!o){var a=t.parent();o=a.attr(i)||a.attr(n)}}var l=o?w.byId[o]:this.root;return f("nodeId is the id of some Node that exists",l),r.clearSelection().show(),l.seek(e,r),this.scrollHoriz(),this}}),T.open(function(t){t.scrollHoriz=function(){var t=this.cursor,e=t.selection,n=this.root.jQ[0].getBoundingClientRect();if(e){var i=e.jQ[0].getBoundingClientRect(),s=i.left-(n.left+20),r=i.right-(n.right-20);if(e.ends[d]===t[m])if(s<0)a=s;else{if(!(r>0))return;if(i.left-r<n.left+20)a=s;else a=r}else if(r>0)a=r;else{if(!(s<0))return;if(i.right-s>n.right-20)a=r;else a=s}}else{var o=t.jQ[0].getBoundingClientRect().left;if(o>n.right-20)var a=o-(n.right-20);else{if(!(o<n.left+20))return;var a=o-(n.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+a},100)}}),T.open(function(e){C.p.substituteTextarea=function(){return v("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},e.createTextarea=function(){var t=this.textareaSpan=v('<span class="mq-textarea"></span>'),e=this.options.substituteTextarea();if(!e.nodeType)throw"substituteTextarea() must return a DOM element, got "+e;e=this.textarea=v(e).appendTo(t);var n=this;n.cursor.selectionChanged=function(){n.selectionChanged()},n.container.bind("copy",function(){n.setTextareaSelection()})},e.selectionChanged=function(){var e=this;wt(e.container[0]),e.textareaSelectionTimeout===t&&(e.textareaSelectionTimeout=setTimeout(function(){e.setTextareaSelection()}))},e.setTextareaSelection=function(){this.textareaSelectionTimeout=t;var e="";this.cursor.selection&&(e=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(e="$"+e+"$")),this.selectFn(e)},e.staticMathTextareaEvents=function(){var t=this,e=(t.root,t.cursor),n=t.textarea,i=t.textareaSpan;function s(){i.detach(),t.blurred=!0}this.container.prepend('<span class="mq-selectable">$'+t.exportLatex()+"$</span>"),t.blurred=!0,n.bind("cut paste",!1).click(function(){t.blurred=!1}).blur(function(){e.selection&&e.selection.clear(),setTimeout(s)}),t.selectFn=function(t){n.val(t),t&&n.select()}},e.editablesTextareaEvents=function(){var t=this,e=(t.root,t.cursor),n=t.textarea,i=t.textareaSpan,s=F(n,this);this.selectFn=function(t){s.select(t)},this.container.prepend(i).on("cut",function(n){e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})}),this.clickBlurEvents()},e.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},e.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}});var N=p(w,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[m].siblingCreated&&n[m].siblingCreated(t,d),n[d].siblingCreated&&n[d].siblingCreated(t,m),n.bubble("reflow")}}),P=p(N,function(t,e){t.init=function(t,n,i){var s=this;e.init.call(s),s.ctrlSeq||(s.ctrlSeq=t),n&&(s.htmlTemplate=n),i&&(s.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=this;return $.block.times(t.numBlocks()).map(function(e){t.blocks=e;for(var n=0;n<e.length;n++)e[n].adopt(t,t.ends[m],0);return t})},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[d],0,0),i.jQ.appendTo(n.ends[d].jQ)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){for(var t=this.numBlocks(),e=this.blocks=Array(t),n=0;n<t;n++){(e[n]=G()).adopt(this,this.ends[m],0)}},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[d],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return Q(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[d]=t.jQ.offset().left,e[m]=e[d]+t.jQ.outerWidth(),e}var i=this,s=n(i);if(t<s[d])return e.insLeftOf(i);if(t>s[m])return e.insRightOf(i);var r=s[d];i.eachChild(function(o){var a=n(o);return t<a[d]?(t-r<a[d]-t?o[d]?e.insAtRightEnd(o[d]):e.insLeftOf(i):e.insAtLeftEnd(o),!1):t>a[m]?void(o[m]?r=a[m]:s[m]-t<t-a[m]?e.insRightOf(i):e.insAtRightEnd(o)):(o.seek(t,e),!1)})},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t=this.blocks,e=" mathquill-command-id="+this.id,n=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);f("no unmatched angle brackets",n.join("")===this.htmlTemplate);for(var i=0,s=n[0];s;s=n[++i])if("/>"===s.slice(-2))n[i]=s.slice(0,-2)+e+"/>";else if("<"===s.charAt(0)){f("not an unmatched top-level close tag","/"!==s.charAt(1)),n[i]=s.slice(0,-1)+e+">";var r=1;do{f("no missing close tags",s=n[++i]),"</"===s.slice(0,2)?r-=1:"<"===s.charAt(0)&&"/>"!==s.slice(-2)&&(r+=1)}while(r>0)}return n.join("").replace(/>&(\d+)/g,function(e,n){return" mathquill-block-id="+t[n].id+">"+t[n].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e++;var s=i.text();return n&&"("===t.textTemplate[e]&&"("===s[0]&&")"===s.slice(-1)?n+s.slice(1,-1)+t.textTemplate[e]:n+i.text()+(t.textTemplate[e]||"")})}}),U=p(P,function(t,e){t.init=function(t,n,i){i||(i=t&&t.length>1?t.slice(1):t),e.init.call(this,t,n,[i])},t.parser=function(){return B.succeed(this)},t.numBlocks=function(){return 0},t.replaces=function(t){t.remove()},t.createBlocks=o,t.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},t.deleteTowards=function(t,e){e[t]=this.remove()[t]},t.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},t.latex=function(){return this.ctrlSeq},t.text=function(){return this.textTemplate},t.placeCursor=o,t.isEmpty=function(){return!0}}),W=p(U,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}}),H=p(U,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i)}}),G=p(N,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[d]===this.ends[m]&&0!==this.ends[d]?this.ends[d].text():this.join("text")},t.keystroke=function(t,n,i){return!i.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?d:m,t,n))},t.moveOutOf=function(t,e,n){!(n&&this.parent[n+"Into"])&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[m];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[d].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[d];return n.seek(t,e)},t.chToCmd=function(t){var e;return t.match(/^[a-eg-zA-Z]$/)?nt(t):/^\d$/.test(t)?tt(t):(e=O[t]||y[t])?e(t):W(t)},t.write=function(t,e){var n=this.chToCmd(e);t.selection&&n.replaces(t.replaceSelection()),n.createLeftOf(t.show())},t.click=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}});j.StaticMath=function(t){return p(t.AbstractMathQuill,function(e,n){this.RootBlock=G,e.__mathquillify=function(){return n.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}})};var K=p(G,M);j.MathField=function(t){return p(t.EditableField,function(t,e){this.RootBlock=K,t.__mathquillify=function(t,n){return this.config(t),n>1&&(this.__controller.root.reflow=o),e.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})};var Y=p(w,function(t,e){function n(t){t.jQ[0].normalize();var e=t.jQ[0].firstChild;f("only node in TextBlock span is Text node",3===e.nodeType);var n=X(e.data);return n.jQadd(e),t.children().disown(),n.adopt(t,0,0)}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof x?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[d]&&this.ends[d].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var n=this;if(e.createLeftOf.call(this,t),n[m].siblingCreated&&n[m].siblingCreated(t.options,d),n[d].siblingCreated&&n[d].siblingCreated(t.options,m),n.bubble("reflow"),t.insAtRightEnd(n),n.replacedText)for(var i=0;i<n.replacedText.length;i++)n.write(t,n.replacedText.charAt(i))},t.parser=function(){var t=this,e=B.string,n=B.regex;return B.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return X(e).adopt(t,0,0),t})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){return"\\text{"+this.textContents()+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=P.prototype.selectTowards,t.deleteTowards=P.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n){if(t.show().deleteSelection(),"$"!==n)t[d]?t[d].appendText(n):X(n).createLeftOf(t);else if(this.isEmpty())t.insRightOf(this),W("\\$","$").createLeftOf(t);else if(t[m])if(t[d]){var i=Y(),s=this.ends[d];s.disown(),s.adopt(i,0,0),t.insLeftOf(this),e.createLeftOf.call(i,t)}else t.insLeftOf(this);else t.insRightOf(this)},t.seek=function(t,e){e.hide();var i=n(this),s=this.jQ.width()/this.text.length,r=Math.round((t-this.jQ.offset().left)/s);r<=0?e.insAtLeftEnd(this):r>=i.text.length?e.insAtRightEnd(this):e.insLeftOf(i.splitRight(r));for(var o=t-e.show().offset().left,a=o&&o<0?d:m,l=a;e[a]&&o*l>0;)e[a].moveTowards(a,e),l=o,o=t-e.offset().left;if(a*o<-a*l&&e[-a].moveTowards(-a,e),e.anticursor){if(e.anticursor.parent===this){var c=e[d]&&e[d].text.length;if(this.anticursorPosition===c)e.anticursor=b.copy(e);else{if(this.anticursorPosition<c){var h=e[d].splitRight(this.anticursorPosition);e[d]=h}else h=e[m].splitRight(this.anticursorPosition-c);e.anticursor=b(this,h[d],h)}}}else this.anticursorPosition=e[d]&&e[d].text.length},t.blur=function(){G.prototype.blur.call(this),n(this)},t.click=G.prototype.click}),X=p(w,function(t,e){function n(t,e){return e.charAt(t===d?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=v(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){g(e),e===m?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=X(this.text.slice(t)).adopt(this.parent,this,this[m]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){g(t);var i=n(-t,this.text),s=this[-t];return s?s.insTextAtDirEnd(i,t):X(i).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?t===m?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){g(t);var i=e.anticursor,s=n(-t,this.text);if(i[t]===this){var r=X(s).createDir(t,e);i[t]=r,e.insDirOf(t,r)}else{var o=this[-t];if(o)o.insTextAtDirEnd(s,t);else(r=X(s).createDir(-t,e)).jQ.insDirOf(-t,e.selection.jQ);1===this.text.length&&i[-t]===this&&(i[-t]=this[-t])}return this.deleteTowards(t,e)}});function Z(t,e,n){return p(Y,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}O.$=y.text=y.textnormal=y.textrm=y.textup=y.textmd=Y,y.em=y.italic=y.italics=y.emph=y.textit=y.textsl=Z("\\textit","i",'class="mq-text-mode"'),y.strong=y.bold=y.textbf=Z("\\textbf","b",'class="mq-text-mode"'),y.sf=y.textsf=Z("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),y.tt=y.texttt=Z("\\texttt","span",'class="mq-monospace mq-text-mode"'),y.textsc=Z("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),y.uppercase=Z("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),y.lowercase=Z("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');var V=p(P,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[d].cursor=this.cursor,this.ends[d].write=function(t,e){"$"!==e?G.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),W("\\$","$").createLeftOf(t.show())):t[m]?t[d]?G.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[d].latex()+"$"}}),J=p(K,function(t,e){t.keystroke=function(t){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return e.keystroke.apply(this,arguments)},t.write=function(t,e){var n;(t.show().deleteSelection(),"$"===e)?V(t).createLeftOf(t):("<"===e?n="&lt;":">"===e&&(n="&gt;"),W(e,n).createLeftOf(t))}});j.TextField=function(t){return p(t.EditableField,function(t,e){this.RootBlock=J,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})};O["\\"]=p(P,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[d].click=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[d].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[d].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?W(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||this.parent.parent.write(t,e))},this.ends[d].keystroke=function(t,n,i){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(i.cursor),void n.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return v(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[d].latex()+" "},t.renderCommand=function(t){this.jQ=this.jQ.last(),this.remove(),this[m]?t.insLeftOf(this[m]):t.insAtRightEnd(this.parent);var e=this.ends[d].latex();e||(e=" ");var n=y[e];n?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):((n=Y()).replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}});y.notin=y.cong=y.equiv=y.oplus=y.otimes=p(H,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),y["≠"]=y.ne=y.neq=u(H,"\\ne ","&ne;"),y.ast=y.star=y.loast=y.lowast=u(H,"\\ast ","&lowast;"),y.therefor=y.therefore=u(H,"\\therefore ","&there4;"),y.cuz=y.because=u(H,"\\because ","&#8757;"),y.prop=y.propto=u(H,"\\propto ","&prop;"),y["≈"]=y.asymp=y.approx=u(H,"\\approx ","&asymp;"),y.isin=y.in=u(H,"\\in ","&isin;"),y.ni=y.contains=u(H,"\\ni ","&ni;"),y.notni=y.niton=y.notcontains=y.doesnotcontain=u(H,"\\not\\ni ","&#8716;"),y.sub=y.subset=u(H,"\\subset ","&sub;"),y.sup=y.supset=y.superset=u(H,"\\supset ","&sup;"),y.nsub=y.notsub=y.nsubset=y.notsubset=u(H,"\\not\\subset ","&#8836;"),y.nsup=y.notsup=y.nsupset=y.notsupset=y.nsuperset=y.notsuperset=u(H,"\\not\\supset ","&#8837;"),y.sube=y.subeq=y.subsete=y.subseteq=u(H,"\\subseteq ","&sube;"),y.supe=y.supeq=y.supsete=y.supseteq=y.supersete=y.superseteq=u(H,"\\supseteq ","&supe;"),y.nsube=y.nsubeq=y.notsube=y.notsubeq=y.nsubsete=y.nsubseteq=y.notsubsete=y.notsubseteq=u(H,"\\not\\subseteq ","&#8840;"),y.nsupe=y.nsupeq=y.notsupe=y.notsupeq=y.nsupsete=y.nsupseteq=y.notsupsete=y.notsupseteq=y.nsupersete=y.nsuperseteq=y.notsupersete=y.notsuperseteq=u(H,"\\not\\supseteq ","&#8841;"),y.N=y.naturals=y.Naturals=u(W,"\\mathbb{N}","&#8469;"),y.P=y.primes=y.Primes=y.projective=y.Projective=y.probability=y.Probability=u(W,"\\mathbb{P}","&#8473;"),y.Z=y.integers=y.Integers=u(W,"\\mathbb{Z}","&#8484;"),y.Q=y.rationals=y.Rationals=u(W,"\\mathbb{Q}","&#8474;"),y.R=y.reals=y.Reals=u(W,"\\mathbb{R}","&#8477;"),y.C=y.complex=y.Complex=y.complexes=y.Complexes=y.complexplane=y.Complexplane=y.ComplexPlane=u(W,"\\mathbb{C}","&#8450;"),y.H=y.Hamiltonian=y.quaternions=y.Quaternions=u(W,"\\mathbb{H}","&#8461;"),y.quad=y.emsp=u(W,"\\quad ","    "),y.qquad=u(W,"\\qquad ","        "),y.diamond=u(W,"\\diamond ","&#9671;"),y.bigtriangleup=u(W,"\\bigtriangleup ","&#9651;"),y.ominus=u(W,"\\ominus ","&#8854;"),y.uplus=u(W,"\\uplus ","&#8846;"),y.bigtriangledown=u(W,"\\bigtriangledown ","&#9661;"),y.sqcap=u(W,"\\sqcap ","&#8851;"),y.triangleleft=u(W,"\\triangleleft ","&#8882;"),y.sqcup=u(W,"\\sqcup ","&#8852;"),y.triangleright=u(W,"\\triangleright ","&#8883;"),y.odot=y.circledot=u(W,"\\odot ","&#8857;"),y.bigcirc=u(W,"\\bigcirc ","&#9711;"),y.dagger=u(W,"\\dagger ","&#0134;"),y.ddagger=u(W,"\\ddagger ","&#135;"),y.wr=u(W,"\\wr ","&#8768;"),y.amalg=u(W,"\\amalg ","&#8720;"),y.models=u(W,"\\models ","&#8872;"),y.prec=u(W,"\\prec ","&#8826;"),y.succ=u(W,"\\succ ","&#8827;"),y.preceq=u(W,"\\preceq ","&#8828;"),y.succeq=u(W,"\\succeq ","&#8829;"),y.simeq=u(W,"\\simeq ","&#8771;"),y.mid=u(W,"\\mid ","&#8739;"),y.ll=u(W,"\\ll ","&#8810;"),y.gg=u(W,"\\gg ","&#8811;"),y.parallel=u(W,"\\parallel ","&#8741;"),y.nparallel=u(W,"\\nparallel ","&#8742;"),y.bowtie=u(W,"\\bowtie ","&#8904;"),y.sqsubset=u(W,"\\sqsubset ","&#8847;"),y.sqsupset=u(W,"\\sqsupset ","&#8848;"),y.smile=u(W,"\\smile ","&#8995;"),y.sqsubseteq=u(W,"\\sqsubseteq ","&#8849;"),y.sqsupseteq=u(W,"\\sqsupseteq ","&#8850;"),y.doteq=u(W,"\\doteq ","&#8784;"),y.frown=u(W,"\\frown ","&#8994;"),y.vdash=u(W,"\\vdash ","&#8870;"),y.dashv=u(W,"\\dashv ","&#8867;"),y.nless=u(W,"\\nless ","&#8814;"),y.ngtr=u(W,"\\ngtr ","&#8815;"),y.longleftarrow=u(W,"\\longleftarrow ","&#8592;"),y.longrightarrow=u(W,"\\longrightarrow ","&#8594;"),y.Longleftarrow=u(W,"\\Longleftarrow ","&#8656;"),y.Longrightarrow=u(W,"\\Longrightarrow ","&#8658;"),y.longleftrightarrow=u(W,"\\longleftrightarrow ","&#8596;"),y.updownarrow=u(W,"\\updownarrow ","&#8597;"),y.Longleftrightarrow=u(W,"\\Longleftrightarrow ","&#8660;"),y.Updownarrow=u(W,"\\Updownarrow ","&#8661;"),y.mapsto=u(W,"\\mapsto ","&#8614;"),y.nearrow=u(W,"\\nearrow ","&#8599;"),y.hookleftarrow=u(W,"\\hookleftarrow ","&#8617;"),y.hookrightarrow=u(W,"\\hookrightarrow ","&#8618;"),y.searrow=u(W,"\\searrow ","&#8600;"),y.leftharpoonup=u(W,"\\leftharpoonup ","&#8636;"),y.rightharpoonup=u(W,"\\rightharpoonup ","&#8640;"),y.swarrow=u(W,"\\swarrow ","&#8601;"),y.leftharpoondown=u(W,"\\leftharpoondown ","&#8637;"),y.rightharpoondown=u(W,"\\rightharpoondown ","&#8641;"),y.nwarrow=u(W,"\\nwarrow ","&#8598;"),y.ldots=u(W,"\\ldots ","&#8230;"),y.cdots=u(W,"\\cdots ","&#8943;"),y.vdots=u(W,"\\vdots ","&#8942;"),y.ddots=u(W,"\\ddots ","&#8945;"),y.surd=u(W,"\\surd ","&#8730;"),y.triangle=u(W,"\\triangle ","&#9651;"),y.ell=u(W,"\\ell ","&#8467;"),y.top=u(W,"\\top ","&#8868;"),y.flat=u(W,"\\flat ","&#9837;"),y.natural=u(W,"\\natural ","&#9838;"),y.sharp=u(W,"\\sharp ","&#9839;"),y.wp=u(W,"\\wp ","&#8472;"),y.bot=u(W,"\\bot ","&#8869;"),y.clubsuit=u(W,"\\clubsuit ","&#9827;"),y.diamondsuit=u(W,"\\diamondsuit ","&#9826;"),y.heartsuit=u(W,"\\heartsuit ","&#9825;"),y.spadesuit=u(W,"\\spadesuit ","&#9824;"),y.parallelogram=u(W,"\\parallelogram ","&#9649;"),y.square=u(W,"\\square ","&#11036;"),y.oint=u(W,"\\oint ","&#8750;"),y.bigcap=u(W,"\\bigcap ","&#8745;"),y.bigcup=u(W,"\\bigcup ","&#8746;"),y.bigsqcup=u(W,"\\bigsqcup ","&#8852;"),y.bigvee=u(W,"\\bigvee ","&#8744;"),y.bigwedge=u(W,"\\bigwedge ","&#8743;"),y.bigodot=u(W,"\\bigodot ","&#8857;"),y.bigotimes=u(W,"\\bigotimes ","&#8855;"),y.bigoplus=u(W,"\\bigoplus ","&#8853;"),y.biguplus=u(W,"\\biguplus ","&#8846;"),y.lfloor=u(W,"\\lfloor ","&#8970;"),y.rfloor=u(W,"\\rfloor ","&#8971;"),y.lceil=u(W,"\\lceil ","&#8968;"),y.rceil=u(W,"\\rceil ","&#8969;"),y.opencurlybrace=y.lbrace=u(W,"\\lbrace ","{"),y.closecurlybrace=y.rbrace=u(W,"\\rbrace ","}"),y.lbrack=u(W,"["),y.rbrack=u(W,"]"),y["∫"]=y.int=y.integral=u(U,"\\int ","<big>&int;</big>"),y.slash=u(W,"/"),y.vert=u(W,"|"),y.perp=y.perpendicular=u(W,"\\perp ","&perp;"),y.nabla=y.del=u(W,"\\nabla ","&nabla;"),y.hbar=u(W,"\\hbar ","&#8463;"),y.AA=y.Angstrom=y.angstrom=u(W,"\\text\\AA ","&#8491;"),y.ring=y.circ=y.circle=u(W,"\\circ ","&#8728;"),y.bull=y.bullet=u(W,"\\bullet ","&bull;"),y.setminus=y.smallsetminus=u(W,"\\setminus ","&#8726;"),y.not=y["¬"]=y.neg=u(W,"\\neg ","&not;"),y["…"]=y.dots=y.ellip=y.hellip=y.ellipsis=y.hellipsis=u(W,"\\dots ","&hellip;"),y.converges=y.darr=y.dnarr=y.dnarrow=y.downarrow=u(W,"\\downarrow ","&darr;"),y.dArr=y.dnArr=y.dnArrow=y.Downarrow=u(W,"\\Downarrow ","&dArr;"),y.diverges=y.uarr=y.uparrow=u(W,"\\uparrow ","&uarr;"),y.uArr=y.Uparrow=u(W,"\\Uparrow ","&uArr;"),y.to=u(H,"\\to ","&rarr;"),y.rarr=y.rightarrow=u(W,"\\rightarrow ","&rarr;"),y.implies=u(H,"\\Rightarrow ","&rArr;"),y.rArr=y.Rightarrow=u(W,"\\Rightarrow ","&rArr;"),y.gets=u(H,"\\gets ","&larr;"),y.larr=y.leftarrow=u(W,"\\leftarrow ","&larr;"),y.impliedby=u(H,"\\Leftarrow ","&lArr;"),y.lArr=y.Leftarrow=u(W,"\\Leftarrow ","&lArr;"),y.harr=y.lrarr=y.leftrightarrow=u(W,"\\leftrightarrow ","&harr;"),y.iff=u(H,"\\Leftrightarrow ","&hArr;"),y.hArr=y.lrArr=y.Leftrightarrow=u(W,"\\Leftrightarrow ","&hArr;"),y.Re=y.Real=y.real=u(W,"\\Re ","&real;"),y.Im=y.imag=y.image=y.imagin=y.imaginary=y.Imaginary=u(W,"\\Im ","&image;"),y.part=y.partial=u(W,"\\partial ","&part;"),y.infty=y.infin=y.infinity=u(W,"\\infty ","&infin;"),y.alef=y.alefsym=y.aleph=y.alephsym=u(W,"\\aleph ","&alefsym;"),y.xist=y.xists=y.exist=y.exists=u(W,"\\exists ","&exist;"),y.and=y.land=y.wedge=u(W,"\\wedge ","&and;"),y.or=y.lor=y.vee=u(W,"\\vee ","&or;"),y.o=y.O=y.empty=y.emptyset=y.oslash=y.Oslash=y.nothing=y.varnothing=u(H,"\\varnothing ","&empty;"),y.cup=y.union=u(H,"\\cup ","&cup;"),y.cap=y.intersect=y.intersection=u(H,"\\cap ","&cap;"),y.deg=y.degree=u(W,"\\degree ","&deg;"),y.ang=y.angle=u(W,"\\angle ","&ang;"),y.measuredangle=u(W,"\\measuredangle ","&#8737;");var tt=p(W,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[d]instanceof et&&!1!==t[d].isItalic||t[d]instanceof Ot&&t[d][d]instanceof et&&!1!==t[d][d].isItalic)?(y._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}}),et=p(U,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[d]||this[d]instanceof et||this[d]instanceof H||"\\ "===this[d].ctrlSeq||(t="*"+t),!this[m]||this[m]instanceof H||this[m]instanceof Ot||(t+="*"),t}});C.p.autoCommands={_maxLength:0},D.autoCommands=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),n={},i=0,s=0;s<e.length;s++){var o=e[s];if(o.length<2)throw'autocommand "'+o+'" not minimum length of 2';if(y[o]===lt)throw'"'+o+'" is a built-in operator name';n[o]=1,i=r(i,o.length)}return n._maxLength=i,n};for(var nt=p(et,function(t,e){function n(t){return t instanceof U&&!(t instanceof H)}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){var n=t.options.autoCommands,i=n._maxLength;if(i>0){for(var s=this.letter,r=t[d],o=1;r instanceof nt&&o<i;)s=r.letter+s,r=r[d],o++;for(;s.length;){if(n.hasOwnProperty(s)){for(o=2,r=t[d];o<s.length;o++,r=r[d]);return x(r,t[d]).remove(),t[d]=r[d],y[s](s).createLeftOf(t)}s=s.slice(1)}}e.createLeftOf.apply(this,arguments)},t.italicize=function(t){return this.isItalic=t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==d&&this[m]instanceof nt||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e=t.autoOperatorNames;if(0!==e._maxLength){for(var i=this.letter,r=this[d];r instanceof nt;r=r[d])i=r.letter+i;for(var o=this[m];o instanceof nt;o=o[m])i+=o.letter;x(r[m]||this.parent.ends[d],o[d]||this.parent.ends[m]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last"),t.ctrlSeq=t.letter});t:for(var a=0,l=r[m]||this.parent.ends[d];a<i.length;a++,l=l[m])for(var c=s(e._maxLength,i.length-a);c>0;c-=1){var h=i.slice(a,a+c);if(e.hasOwnProperty(h)){for(var u=0,f=l;u<c;u+=1,f=f[m]){f.italicize(!1);var p=f}var g=it.hasOwnProperty(h);l.ctrlSeq=(g?"\\":"\\operatorname{")+l.ctrlSeq,p.ctrlSeq+=g?" ":"}",rt.hasOwnProperty(h)&&p[d][d][d].jQ.addClass("mq-last"),n(l[d])&&l.jQ.addClass("mq-first"),n(p[m])&&p.jQ.addClass("mq-last"),a+=c-1,l=p;continue t}}}}}),it={},st=C.p.autoOperatorNames={_maxLength:9},rt={limsup:1,liminf:1,projlim:1,injlim:1},ot="ln log cos sin tan acos asin atan".split(" "),at=0;at<ot.length;at++)it[ot[at]]=st[ot[at]]=1;D.autoOperatorNames=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),n={},i=0,s=0;s<e.length;s++){var o=e[s];if(o.length<2)throw'"'+o+'" not minimum length of 2';n[o]=1,i=r(i,o.length)}return n._maxLength=i,n};var lt=p(p(P,_t),function(t,e){t.init=function(t){this.ctrlSeq=t,this.htmlTemplate='<var class="mq-operator-name">'+t+'</var><span class="mq-non-leaf"><span class="mq-scaled mq-paren">(</span><span class="mq-non-leaf"><span>&0</span></span><span class="mq-scaled mq-paren">)</span></span>',this.textTemplate=[t+"(",")"],e.init.call(this,t)}});for(var ct in st)st.hasOwnProperty(ct)&&(y[ct]=lt);y.operatorname=p(P,function(t){t.createLeftOf=o,t.numBlocks=function(){return 1},t.parser=function(){return $.block.map(function(t){return t.children()})}}),y.f=p(nt,function(t,e){t.init=function(){U.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),y[" "]=y.space=u(W,"\\ ","&nbsp;"),y["'"]=y.prime=u(W,"'","&prime;"),y.backslash=u(W,"\\backslash ","\\"),O["\\"]||(O["\\"]=y.backslash),y.$=u(W,"\\$","$");var ht=p(U,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}});y["@"]=ht,y["&"]=u(ht,"\\&","&amp;"),y["%"]=u(ht,"\\%","%"),y.alpha=y.beta=y.gamma=y.delta=y.zeta=y.eta=y.theta=y.iota=y.kappa=y.mu=y.nu=y.xi=y.rho=y.sigma=y.tau=y.chi=y.psi=y.omega=p(et,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),y.phi=u(et,"\\phi ","&#981;"),y.phiv=y.varphi=u(et,"\\varphi ","&phi;"),y.epsilon=u(et,"\\epsilon ","&#1013;"),y.epsiv=y.varepsilon=u(et,"\\varepsilon ","&epsilon;"),y.piv=y.varpi=u(et,"\\varpi ","&piv;"),y.sigmaf=y.sigmav=y.varsigma=u(et,"\\varsigma ","&sigmaf;"),y.thetav=y.vartheta=y.thetasym=u(et,"\\vartheta ","&thetasym;"),y.upsilon=y.upsi=u(et,"\\upsilon ","&upsilon;"),y.gammad=y.Gammad=y.digamma=u(et,"\\digamma ","&#989;"),y.kappav=y.varkappa=u(et,"\\varkappa ","&#1008;"),y.rhov=y.varrho=u(et,"\\varrho ","&#1009;"),y.pi=y["π"]=u(ht,"\\pi ","&pi;"),y.lambda=u(ht,"\\lambda ","&lambda;"),y.Upsilon=y.Upsi=y.upsih=y.Upsih=u(U,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),y.Gamma=y.Delta=y.Theta=y.Lambda=y.Xi=y.Pi=y.Sigma=y.Phi=y.Psi=y.Omega=y.forall=p(W,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}});var ut=p(P,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=$.parse(this.latex);e.children().adopt(t.parent,t[d],t[m]),t[d]=e.ends[m],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[m][m].siblingCreated&&e.ends[m][m].siblingCreated(t.options,d),e.ends[d][d].siblingCreated&&e.ends[d][d].siblingCreated(t.options,m),t.parent.bubble("reflow")},t.parser=function(){var t=$.parse(this.latex).children();return B.succeed(t)}});y["¹"]=u(ut,"^1"),y["²"]=u(ut,"^2"),y["³"]=u(ut,"^3"),y["¼"]=u(ut,"\\frac14"),y["½"]=u(ut,"\\frac12"),y["¾"]=u(ut,"\\frac34");var ft=p(H,function(t){t.init=W.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){if(e!==m)return this.jQ[0].className=!this[d]||this[d]instanceof H?"":"mq-binary-operator",this}});y["+"]=u(ft,"+","+"),y["–"]=y["-"]=u(ft,"-","&minus;"),y["±"]=y.pm=y.plusmn=y.plusminus=u(ft,"\\pm ","&plusmn;"),y.mp=y.mnplus=y.minusplus=u(ft,"\\mp ","&#8723;"),y["×"]=y.times=O["*"]=y.sdot=y.cdot=u(H,"\\times ","&times;","*");var pt=p(H,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":"";e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){if(t===d&&!this.strict)return this.swap(!0),void this.bubble("reflow");e.deleteTowards.apply(this,arguments)}}),dt={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},mt={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};y["<"]=y.lt=u(pt,dt,!0),y[">"]=y.gt=u(pt,mt,!0),y["≤"]=y.le=y.leq=u(pt,dt,!1),y["≥"]=y.ge=y.geq=u(pt,mt,!1);var gt=p(H,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){if(t[d]instanceof pt&&t[d].strict)return t[d].swap(!1),void t[d].bubble("reflow");e.createLeftOf.apply(this,arguments)}});y["="]=gt,y["÷"]=y.div=y.divide=y.divides=u(H,"\\div ","&divide;","[/]"),O["~"]=y.sim=u(H,"\\sim ","~","~");var vt,bt,wt=o,qt=document.createElement("div").style;for(var xt in{transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1})if(xt in qt){bt=xt;break}bt?vt=function(t,e,n){t.css(bt,"scale("+e+","+n+")")}:"filter"in qt?(wt=function(t){t.className=t.className},vt=function(t,e,n){e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var i=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')");function s(){t.css("marginRight",(i.width()-1)*(e-1)/e+"px")}s();var r=setInterval(s);v(window).load(function(){clearTimeout(r),s()})}):vt=function(t,e,n){t.css("fontSize",n+"em")};var yt=p(P,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}});y.mathrm=u(yt,"\\mathrm","span",'class="mq-roman mq-font"'),y.mathit=u(yt,"\\mathit","i",'class="mq-font"'),y.mathbf=u(yt,"\\mathbf","b",'class="mq-font"'),y.mathsf=u(yt,"\\mathsf","span",'class="mq-sans-serif mq-font"'),y.mathtt=u(yt,"\\mathtt","span",'class="mq-monospace mq-font"'),y.underline=u(yt,"\\underline","span",'class="mq-non-leaf mq-underline"'),y.overline=y.bar=u(yt,"\\overline","span",'class="mq-non-leaf mq-overline"'),y.overrightarrow=u(yt,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),y.overleftarrow=u(yt,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"');y.textcolor=p(P,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=B.optWhitespace,i=B.string,s=B.regex;return n.then(i("{")).then(s(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(n){return t.setColor(n),e.parser.call(t)})}}),y.class=p(P,function(t,e){t.parser=function(){var t=this,n=B.string,i=B.regex;return B.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})}});var Ot=p(P,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){if(t[d]||!t.options.supSubsRequireOperand)return e.createLeftOf.apply(this,arguments)},t.contactWeld=function(t){for(var e=d;e;e=e===d&&m)if(this[e]instanceof Ot){for(var n="sub";n;n="sub"===n&&"sup"){var i=this[n],s=this[e][n];if(i){if(s)if(i.isEmpty())o=b(s,0,s.ends[d]);else{i.jQ.children().insAtDirEnd(-e,s.jQ);var r=i.children().disown(),o=b(s,r.ends[m],s.ends[d]);e===d?r.adopt(s,s.ends[m],0):r.adopt(s,0,s.ends[d])}else this[e].addBlock(i.disown());this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(s,i)}}this.remove(),t&&t[d]===this&&(e===m&&o?o[d]?t.insRightOf(o[d]):t.insAtLeftEnd(o.parent):t.insRightOf(this[e]));break}this.respace()},C.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[d].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e);return n instanceof U?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show())}t[d]&&!t[m]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),G.p.write.apply(this,arguments)}},t.moveTowards=function(t,n,i){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];i instanceof U?i.remove():i&&i.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(d,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.respace=t.siblingCreated=t.siblingDeleted=function(t,e){e!==m&&this.jQ.toggleClass("mq-limit","\\int "===this[d].ctrlSeq)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=v('<span class="mq-sup"/>').append(t.jQ.children()).attr(i,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=v('<span class="mq-sub"></span>').append(t.jQ.children()).attr(i,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e++)!function(t,e,n,i){t[e].deleteOutOf=function(s,r){if(r.insDirOf(this[s]?-s:s,this.parent),!this.isEmpty()){var o=this.ends[s];this.children().disown().withDirAdopt(s,r.parent,r[s],r[-s]).jQ.insDirOf(-s,r.jQ),r[-s]=o}t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=kt,delete t[n].deleteOutOf,"sub"===e&&v(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}});function kt(t){var e=this.parent,n=t;do{if(n[m])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}y.subscript=y._=p(Ot,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[d],this.sub.upOutOf=kt,e.finalizeTree.call(this)}}),y.superscript=y.supscript=y["^"]=p(Ot,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[m],this.sup.downOutOf=kt,e.finalizeTree.call(this)}});var Qt=p(P,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';U.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(nt("n").createLeftOf(t),gt().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[d].latex())+"^"+t(this.ends[m].latex())},t.parser=function(){for(var t=B.string,e=B.optWhitespace,n=B.succeed,i=$.block,s=this,r=s.blocks=[G(),G()],o=0;o<r.length;o++)r[o].adopt(s,s.ends[m],0);return e.then(t("_").or(t("^"))).then(function(t){var e=r["_"===t?0:1];return i.then(function(t){return t.children().adopt(e,e.ends[m],0),n(s)})}).many().result(s)},t.finalizeTree=function(){this.downInto=this.ends[d],this.upInto=this.ends[m],this.ends[d].upOutOf=this.ends[m],this.ends[m].downOutOf=this.ends[d]}});y["∑"]=y.sum=y.summation=u(Qt,"\\sum ","&sum;"),y["∏"]=y.prod=y.product=u(Qt,"\\prod ","&prod;"),y.coprod=y.coproduct=u(Qt,"\\coprod ","&#8720;");var Tt=y.frac=y.dfrac=y.cfrac=y.fraction=p(P,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[m].upOutOf=this.ends[d],this.downInto=this.ends[d].downOutOf=this.ends[m]}}),jt=y.over=O["/"]=p(Tt,function(t,e){t.createLeftOf=function(t){if(!this.replacedFragment){for(var n=t[d];n&&!(n instanceof H||n instanceof(y.text||o)||n instanceof Qt||"\\ "===n.ctrlSeq||/^[,;:]$/.test(n.ctrlSeq));)n=n[d];n instanceof Qt&&n[m]instanceof Ot&&(n=n[m])[m]instanceof Ot&&n[m].ctrlSeq!=n.ctrlSeq&&(n=n[m]),n!==t[d]&&(this.replaces(x(n[m]||t.parent.ends[d],t[d])),t[d]=n)}e.createLeftOf.call(this,t)}}),Ct=y.sqrt=y["√"]=p(P,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return $.optBlock.then(function(t){return $.block.map(function(e){var n=Dt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[m].jQ;vt(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),Dt=(y.vec=p(P,function(t,e){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]}),y.nthroot=p(Ct,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["nthroot(",",",")"],t.latex=function(){return"\\sqrt["+this.ends[d].latex()+"]{"+this.ends[m].latex()+"}"}}));function _t(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));vt(this.delimjQs,s(1+.2*(t-1),1.2),1.2*t)}}var St=p(p(P,_t),function(e,n){e.init=function(e,i,s,r,o){n.init.call(this,"\\left"+r,t,[i,s]),this.side=e,this.sides={},this.sides[d]={ch:i,ctrlSeq:r},this.sides[m]={ch:s,ctrlSeq:o}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===m?" mq-ghost":"")+'">'+this.sides[d].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===d?" mq-ghost":"")+'">'+this.sides[m].ch+"</span></span>",n.html.call(this)},e.latex=function(){return"\\left"+this.sides[d].ctrlSeq+this.ends[d].latex()+"\\right"+this.sides[m].ctrlSeq},e.oppBrack=function(t,e,n){return e instanceof St&&e.side&&e.side!==-n&&("|"===this.sides[this.side].ch||e.side===-this.side)&&(!t.restrictMismatchedBrackets||Et[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[d].ch]===e.sides[m].ch)&&e},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===d?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){if(!this.replacedFragment)var e=t.options,i=this.oppBrack(e,t[d],d)||this.oppBrack(e,t[m],m)||this.oppBrack(e,t.parent.parent);if(i){var s=this.side=-i.side;this.closeOpposing(i),i===t.parent.parent&&t[s]&&(x(t[s],t.parent.ends[s],-s).disown().withDirAdopt(-s,i.parent,i,i[s]).jQ.insDirOf(s,i.jQ),i.bubble("reflow"))}else s=(i=this).side,i.replacedFragment?i.side=0:t[-s]&&(i.replaces(x(t[-s],t.parent.ends[-s],s)),t[-s]=0),n.createLeftOf.call(i,t);s===d?t.insAtLeftEnd(i.ends[d]):t.insRightOf(i)},e.placeCursor=o,e.unwrap=function(){this.ends[d].children().disown().adopt(this.parent,this,this[m]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,e,n){var i=this.parent,s=this[t],r=i.ends[t];if(t===this.side)return this.unwrap(),void(s?n.insDirOf(-t,s):n.insAtDirEnd(t,i));var o=n.options,a=!this.side;if(this.side=-t,this.oppBrack(o,this.ends[d].ends[this.side],t)){this.closeOpposing(this.ends[d].ends[this.side]);var l=this.ends[d].ends[t];this.unwrap(),l.siblingCreated&&l.siblingCreated(n.options,t),s?n.insDirOf(-t,s):n.insAtDirEnd(t,i)}else{if(this.oppBrack(o,this.parent.parent,t))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&a)return this.unwrap(),void(s?n.insDirOf(-t,s):n.insAtDirEnd(t,i));this.sides[t]={ch:Et[this.sides[this.side].ch],ctrlSeq:Et[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===d?0:1).addClass("mq-ghost").html(this.sides[t].ch)}if(s){l=this.ends[d].ends[t];x(s,r,-t).disown().withDirAdopt(-t,this.ends[d],l,0).jQ.insAtDirEnd(t,this.ends[d].jQ.removeClass("mq-empty")),l.siblingCreated&&l.siblingCreated(n.options,t),n.insDirOf(-t,s)}else e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[d])}},e.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.finalizeTree=function(){this.ends[d].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===d?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),Et={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"};function Lt(t,e){e=e||t;var n=Et[t],i=Et[e];O[t]=u(St,d,t,n,e,i),O[n]=u(St,m,t,n,e,i)}Lt("("),Lt("["),Lt("{","\\{"),y.langle=u(St,d,"&lang;","&rang;","\\langle ","\\rangle "),y.rangle=u(St,m,"&lang;","&rang;","\\langle ","\\rangle "),O["|"]=u(St,d,"|","|","|","|"),y.left=p(P,function(t){t.parser=function(){var t=B.regex,e=B.string,n=(B.succeed,B.optWhitespace);return n.then(t(/^(?:[([|]|\\\{)/)).then(function(i){var s="\\"===i.charAt(0)?i.slice(1):i;return $.then(function(r){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\})/)).map(function(t){var e="\\"===t.charAt(0)?t.slice(1):t,n=St(0,s,e,i,t);return n.blocks=[r],r.adopt(n,0,0),n})})})}}),y.right=p(P,function(t){t.parser=function(){return B.fail("unmatched \\right")}});var At=y.binom=y.binomial=p(p(P,_t),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]});y.choose=p(At,function(t){t.createLeftOf=jt.prototype.createLeftOf});y.editable=y.MathQuillMathField=p(P,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=B.string,i=B.regex,s=B.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(s()).then(e.parser.call(t))},t.finalizeTree=function(){var t=T(this.ends[d],this.jQ,C());t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),M(t.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[d].controller))},t.latex=function(){return this.ends[d].latex()},t.text=function(){return this.ends[d].text()}});var Rt=y.embed=p(U,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this;return string=B.string,regex=B.regex,succeed=B.succeed,string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then(function(e){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map(function(n){return t.setOptions(S[e](n))})})}}),It=I(1);for(var zt in It)!function(t,e){"function"==typeof e?(L[t]=function(){return E(),e.apply(this,arguments)},L[t].prototype=e.prototype):L[t]=e}(zt,It[zt])}();